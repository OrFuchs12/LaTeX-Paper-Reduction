


% \DeclareCaptionFormat{}{\hrule}{}
\captionsetup[lstlisting]{labelfont=bf,singlelinecheck=off,labelsep=space}{}
\begin{lstlisting}[floatplacement=h,numbersymbol=$:$,language=json,caption={The Locusts Swarm domain in pseudo PPL code.},label={lst:LocustsDomain_PPL},basicstyle=\tiny] 
coordinates enum {x,y}
directions enum {up,down,left,right}
overnight_transitions=2 //The number of nightly swarm movements.

//state variables:
tons_of_plants_in_cells[3,3]=10 //10 tons in each of 3x3 cells
swarm_location = (2,2) //The (x,y) location of the swarm.
swarm_disabled=false //Determine if the swarm is disabled and no longer damages the plants.

//'disable_swarm_action' is the location we want to spray the pesticides. 's' is the state we want to sample from. 
function sample_next_state(disable_swarm_action,s)
    for move in 1 to overnight_transitions //Repeat by the number of the swarm nightly transitions.
        total_weight=0	
        weights[4]
        
        //Calculate the probability for the swarm to go in each direction based on the amounts of plants there. 
        weights[up]= if s.swarm_location[y] > 2 then 0.0 else s.tons_of_plants_in_cells[s.swarm_location[x],s.swarm_location[y]+1]
        weights[down]= if s.swarm_location[y] < 2 then 0.0 else s.tons_of_plants_in_cells[s.swarm_location[x],s.swarm_location[y]-1]
        weights[right]= if s.swarm_location[x] > 2 then 0.0 else s.tons_of_plants_in_cells[s.swarm_location[x]+1],s.swarm_location[y]]
        weights[left]= if s.swarm_location[x] < 2 then 0.0 else s.tons_of_plants_in_cells[s.swarm_location[x]-1],s.swarm_location[y]]
        total_weight = weights[up] + weights[down] + weights[right] + weights[left]
        
        for move_direction in directions //Normalize the weights.
            weights[move_direction]=weights[move_direction]/total_weight
        move_direction = sample_discrete(weights) //Sample the swarm movement direction.
        
        //Calculate the new swarm location based on the sampled direction.
        s.swarm_location[x] = switch(move_direction){
                                    case right: s.swarm_location[x]+1
                                    case left: s.swarm_location[x]-1
                                    default: s.swarm_location[x]
                                    }
        s.swarm_location[y] = switch(move_direction){
                                    case up: s.swarm_location[y]+1
                                    case down: s.swarm_location[y]-1
                                    default: s.swarm_location[y]
                                    }
        if not s.swarm_disabled //If the swarm is not disabled, it eats half the food in its current location.
            s.tons_of_plants_in_cells[swarm_location] = 0.5 * s.tons_of_plants_in_cells[swarm_location]
            
    if s.disable_swarm_action == s.swarm_location //The swarm is disabled if the crop duster sprayed its last location.
        s.swarm_disabled=true
        
    //The reward is the total number of plants left in the nature reserve.
    reward =0
    foreach tons_in_cell in s.tons_of_plants_in_cells
        reward= reward+tons_in_cell
    return reward,s //Return the reward and the sampled next state.
\end{lstlisting}  