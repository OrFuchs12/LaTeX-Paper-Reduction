%File: formatting-instructions-latex-2023.tex
%release 2023.0
\documentclass[letterpaper]{article} % DO NOT CHANGE THIS
\usepackage{aaai23}  % DO NOT CHANGE THIS
\usepackage{times}  % DO NOT CHANGE THIS
\usepackage{helvet}  % DO NOT CHANGE THIS
\usepackage{courier}  % DO NOT CHANGE THIS
\usepackage[hyphens]{url}  % DO NOT CHANGE THIS
\usepackage{graphicx} % DO NOT CHANGE THIS
\urlstyle{rm} % DO NOT CHANGE THIS
\def\UrlFont{\rm}  % DO NOT CHANGE THIS
\usepackage{natbib}  % DO NOT CHANGE THIS AND DO NOT ADD ANY OPTIONS TO IT
\usepackage{caption} % DO NOT CHANGE THIS AND DO NOT ADD ANY OPTIONS TO IT
\frenchspacing  % DO NOT CHANGE THIS
\setlength{\pdfpagewidth}{8.5in}  % DO NOT CHANGE THIS
\setlength{\pdfpageheight}{11in}  % DO NOT CHANGE THIS
%
% These are recommended to typeset algorithms but not required. See the subsubsection on algorithms. Remove them if you don't have algorithms in your paper.
\usepackage{algorithm}
\usepackage{algorithmic}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amsfonts}
% \usepackage{bbm}
\usepackage{dsfont}
\usepackage{booktabs}
\usepackage[usenames,dvipsnames]{color}

%
% These are are recommended to typeset listings but not required. See the subsubsection on listing. Remove this block if you don't have listings in your paper.
\usepackage{newfloat}
\usepackage{listings}
\DeclareCaptionStyle{ruled}{labelfont=normalfont,labelsep=colon,strut=off} % DO NOT CHANGE THIS
\lstset{%
	basicstyle={\footnotesize\ttfamily},% footnotesize acceptable for monospace
	numbers=left,numberstyle=\footnotesize,xleftmargin=2em,% show line numbers, remove this entire line if you don't want the numbers.
	aboveskip=0pt,belowskip=0pt,%
	showstringspaces=false,tabsize=2,breaklines=true}
\floatstyle{ruled}
\newfloat{listing}{tb}{lst}{}
\floatname{listing}{Listing}
%
% Keep the \pdfinfo as shown here. There's no need
% for you to add the /Title and /Author tags.

\newtheorem{example}{Example}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}{Lemma}
\newtheorem{definition}{Definition}
\newtheorem{problem}{Problem}
\newtheorem{remark}{Remark}
\newtheorem{corollary}{Corollary}
\newtheorem{observation}{Observation}

\DeclareMathOperator*{\argmax}{arg\,max}
\DeclareMathOperator*{\argmin}{arg\,min}
\DeclareMathOperator*{\poly}{poly}

% DISALLOWED PACKAGES
% \usepackage{authblk} -- This package is specifically forbidden
% \usepackage{balance} -- This package is specifically forbidden
% \usepackage{color (if used in text)
% \usepackage{CJK} -- This package is specifically forbidden
% \usepackage{float} -- This package is specifically forbidden
% \usepackage{flushend} -- This package is specifically forbidden
% \usepackage{fontenc} -- This package is specifically forbidden
% \usepackage{fullpage} -- This package is specifically forbidden
% \usepackage{geometry} -- This package is specifically forbidden
% \usepackage{grffile} -- This package is specifically forbidden
% \usepackage{hyperref} -- This package is specifically forbidden
% \usepackage{navigator} -- This package is specifically forbidden
% (or any other package that embeds links such as navigator or hyperref)
% \indentfirst} -- This package is specifically forbidden
% \layout} -- This package is specifically forbidden
% \multicol} -- This package is specifically forbidden
% \nameref} -- This package is specifically forbidden
% \usepackage{savetrees} -- This package is specifically forbidden
% \usepackage{setspace} -- This package is specifically forbidden
% \usepackage{stfloats} -- This package is specifically forbidden
% \usepackage{tabu} -- This package is specifically forbidden
% \usepackage{titlesec} -- This package is specifically forbidden
% \usepackage{tocbibind} -- This package is specifically forbidden
% \usepackage{ulem} -- This package is specifically forbidden
% \usepackage{wrapfig} -- This package is specifically forbidden
% DISALLOWED COMMANDS
% \nocopyright -- Your paper will not be published if you use this command
% \addtolength -- This command may not be used
% \balance -- This command may not be used
% \baselinestretch -- Your paper will not be published if you use this command
% \clearpage -- No page breaks of any kind may be used for the final version of your paper
% \columnsep -- This command may not be used
% \newpage -- No page breaks of any kind may be used for the final version of your paper
% \pagebreak -- No page breaks of any kind may be used for the final version of your paperr
% \pagestyle -- This command may not be used
% \tiny -- This is not an acceptable font size.
% \vspace{- -- No negative value may be used in proximity of a caption, figure, table, section, subsection, subsubsection, or reference
% \vskip{- -- No negative value may be used to alter spacing above or below a caption, figure, table, section, subsection, subsubsection, or reference

\setcounter{secnumdepth}{0} %May be changed to 1 or 2 if section numbers are desired.

% The file aaai23.sty is the style file for AAAI Press
% proceedings, working notes, and technical reports.
%

% Title

% Your title must be in mixed case, not sentence case.
% That means all verbs (including short verbs like be, is, using,and go),
% nouns, adverbs, adjectives should be capitalized, including both words in hyphenated terms, while
% articles, conjunctions, and prepositions are lower case unless they
% directly follow a colon or long dash
\title{Complexity of Probabilistic Inference in Random Dichotomous Hedonic Games}
\author{
    %Authors
    % All authors must be in the same font size and format.
    Saar Cohen,
    Noa Agmon
}
\affiliations{
    %Afiliations
    % \textsuperscript{\rm 1}Association for the Advancement of Artificial Intelligence\\
    % If you have multiple authors and multiple affiliations
    % use superscripts in text and roman font to identify them.
    % For example,

    % Sunil Issar, \textsuperscript{\rm 2}
    % J. Scott Penberthy, \textsuperscript{\rm 3}
    % George Ferguson,\textsuperscript{\rm 4}
    % Hans Guesgen, \textsuperscript{\rm 5}.
    % Note that the comma should be placed BEFORE the superscript for optimum readability

    Department of Computer Science, Bar-Ilan University, Israel \\
    % email address must be in roman text type, not monospace or sans serif
    saar30@gmail.com,
    agmon@cs.biu.ac.il
%
% See more examples next
}

%Example, Single Author, ->> remove \iffalse,\fi and place them surrounding AAAI title to use it
\iffalse
\title{My Publication Title --- Single Author}
\author {
    Author Name
}
\affiliations{
    Affiliation\\
    Affiliation Line 2\\
    name@example.com
}
\fi

\iffalse
%Example, Multiple Authors, ->> remove \iffalse,\fi and place them surrounding AAAI title to use it
\title{My Publication Title --- Multiple Authors}
\author {
    % Authors
    First Author Name,\textsuperscript{\rm 1,\rm 2}
    Second Author Name, \textsuperscript{\rm 2}
    Third Author Name \textsuperscript{\rm 1}
}
\affiliations {
    % Affiliations
    \textsuperscript{\rm 1} Affiliation 1\\
    \textsuperscript{\rm 2} Affiliation 2\\
    firstAuthor@affiliation1.com, secondAuthor@affilation2.com, thirdAuthor@affiliation1.com
}
\fi


% REMOVE THIS: bibentry
% This is only needed to show inline citations in the guidelines document. You should not need it and can safely delete it.
\usepackage{bibentry}
% END REMOVE bibentry

\begin{document}

\maketitle

\begin{abstract}
\textit{Hedonic games} model cooperative games where agents desire to form coalitions, and only care about the composition of the coalitions of which they are members. %, and are indifferent about the composition of other coalitions.
%Two major underlying assumptions in the literature is that agents' participation in the game and their friendships are certain. %However, both assumptions often fail to hold for real-world problems.
Focusing on various classes of \textit{dichotomous hedonic games}, where each agent either approves or disapproves a given coalition, we propose the \textit{random extension}, where players have an independent participation probability. We initiate the research on the computational complexity of computing the probability that coalitions and partitions are optimal or stable. While some cases admit efficient algorithms (e.g., agents approve only few coalitions), they become computationally hard (\#P-hard) in their complementary scenario. We then investigate the distribution of coalitions in perfect partitions and their performance in \textit{majority games}, where an agent approves coalitions in which the agent is friends with the majority of its members. When friendships independently form with a constant probability, we prove that the number of coalitions of size $3$ converges in distribution to a Poisson random variable.
\end{abstract}

\section{Introduction}
\label{sec:Introduction}
In several real-life scenarios arising from economics, politics, and sociology, we notice the phenomenon of \textit{coalition formation}, where each person, termed as \textit{agent}, forms coalitions with others to get some benefit, experiencing a utility that depends on the particular set of agents she joins. A popular game-theoretic approach to the study of coalition formation problems is \textit{Hedonic games}~\cite{dreze1980hedonic}, whose outcome is a \textit{partition} of the agents into coalitions, over which the agents have preferences. One of their main properties is \textit{non-externality}: an agent minds only her own coalition, regardless of how the others aggregate. Yet, the number of coalitions an agent can be part of is exponential in the number of agents, and therefore it is desirable to consider expressive, but succinctly representable classes of hedonic games. One common approach is to restrict the players' possible preferences. As such, our work focuses on \textit{dichotomous preferences}, where each agent either approves or disapproves of a given coalition \cite{aziz2016boolean}. %, are one of the very few variants of hedonic games that admit polynomial time solutions. Our work thus focuses on DHGs.
%

Two major underlying assumptions in hedonic games literature are that all agents are assured to participate in the game, and the nature of their collaborations and preferences over those are certain. However, both often fail to hold for real-world problems. Generally, participation in the game does not depend only on strategic choices, but also on \textit{external factors}. For instance, in a sports tournament, players may not arrive to the game before its inception due to a last minute injury, weather conditions or traffic jams. %In \textit{elections}, coalitions can form between candidates in order to defeat a common opponent, though one candidate may possibly withdraw from the race and throw his support to another candidate in exchange for policy concessions from that candidate~\cite{shin2019model}. %Another example is \textit{international environmental agreements} to combat climate change, where creating and maintaining full participation in a global climate treaty with meaningful emission reductions is difficult to achieve~\cite{al2020measures} (e.g., the United States' withdrawal from the Paris Agreement in 2015 and the Kyoto Protocol in 2001).
%Specifically,
% \shortstack{ \textcolor{ForestGreen}{\textbf{P:} $\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)$,$\mathcal{WO}_{\mathcal{G}'}^{\Pi}(\pi)$,WO-$\mathcal{C}$-\#CCAUP(-$m$)}; \textcolor{Red}{{\textbf{\#P-h:}} WO-$\Pi$- \& SCS-\#$\exists$CCAUP}; \\ \textcolor{Red}{{\textbf{NP-c:}} $\mathcal{WO}_{\mathcal{G}'}(\pi)>0$,$\mathcal{SCS}_{\mathcal{G}'}>0$,WO-$\Pi$- \& SCS-$\exists$CCAUP}}

% \begin{table*}[t!]
% \centering
% \begin{tabular}{l|c|c|c|c|c}
% \toprule
% Class & $\mathcal{WO}_{\mathcal{C}}(C)$ & $\mathcal{WO}_{\Pi}(\pi)$ & $\mathcal{SCS}$ & $\mathcal{PF}(\pi)$ & $\mathcal{NS}(\pi)$ \\
% \midrule
% $1$-Lists & (\textbf{P}) & \textit{\#P-h.}+\underline{\textbf{NPC}} (P) & \textit{\#P-h.}+\underline{\textbf{NPC}} & &  \\
% \hline
% \shortstack{$k$-Lists} & (\underline{\textbf{P}}+\textbf{\#P-h.}) & \textit{\#P-h.}+\textit{\#W[1]-h.}+\underline{\textbf{NPC}}+\underline{\textbf{W[1]-h.}} (\underline{\textbf{P}}) & \textit{\#P-h.}+\underline{\textbf{NPC}} & \\
% \hline
% AHGs & & & \textit{\#P-h.}+\underline{\textbf{NPC}} & \textit{\#P-h.}+\underline{\textbf{NPC}} (P) & \textit{\#P-h.}+\underline{\textbf{NPC}} (P) \\
% \hline
% CIs & (P) & (P) & & (P) \\
% \hline
% RGs & & & & \underline{\textbf{NPC}} & \underline{\textbf{NPC}} \\
% \bottomrule
% \end{tabular}
% \caption{Overview of complexity results on probabilistic inference for various dichotomous preference representations.}
% \label{tab:complexity results on probabilistic inference}
% \end{table*}

\begin{table*}[t!]
\centering
\begin{tabular}{l|c|c|c}
\toprule
Class & Polynomial & \#P-Hard & NP-Complete \\
\midrule
$1$-Lists & \textbf{$\mathbf{C} \subseteq N$ is WO$_{\mathbf{\mathcal{C}}}$}; {${\pi}$ is WO$_{{\Pi}}$} & \underline{WO}$_{\Pi}$; \underline{SCS} & \textbf{$\mathbf{\pi}$ is WO$\mathbf{_{\Pi} > 0}$}; \textbf{SCS$\mathbf{> 0}$} \\
\hline
\shortstack{$k$-Lists} & \textbf{$\mathbf{C} \subseteq N$ is WO$\mathbf{_{\mathcal{C}} > 0}$}; \textbf{$\mathbf{\pi}$ is WO$\mathbf{_{\Pi} > 0}$} & \textbf{$\mathbf{C} \subseteq N$ is WO$_{\mathbf{\mathcal{C}}}$}; \underline{WO}$_{\Pi}$; \underline{SCS} & \textbf{WO$_{\mathbf{\Pi}}$}$\mathbf{> 0}$; \textbf{$\mathbf{\pi}$ is WO$\mathbf{_{\Pi} > 0}$}; \textbf{SCS$\mathbf{> 0}$} \\
\hline
AHGs & ${\pi}$ is PF; ${\pi}$ is NS & \underline{PF}; \underline{NS}; \underline{SCS} &  \textbf{PF}$\mathbf{> 0}$; \textbf{NS}$\mathbf{> 0}$; \textbf{SCS}$\mathbf{> 0}$ \\
\hline
CIs & $\mathbf{C} \subseteq N$ is WO$_{\mathcal{C}}$; {${\pi}$ is WO$_{{\Pi}}$}; ${\pi}$ is PF &  &  \\
\hline
RGs & & & \textbf{PF}$\mathbf{> 0}$; \textbf{NS}$\mathbf{> 0}$ \\
\bottomrule
\end{tabular}
\caption{Overview of complexity results for various dichotomous preferences. We consider existence of welfare-optimal coalitions or partitions (WO$_{\mathcal{C}}$ and WO$_{\Pi}$, resp.), and perfect (PF), Nash-stable (NS) and strict-core-stable (SCS) partitions. Results in boldface apply to both probabilistic inference and the induced control problem, underlined ones only apply to the control problem and the remaining only apply to probabilistic inference. Considering the "Preliminaries" section, the counting problems (Problem \ref{problem:constructive}) relate to probability computation, whereas decision problems (Problem \ref{problem:Decision}) correspond to verifying its zeroness.}
\label{tab:complexity results on probabilistic inference}
\end{table*}

% \paragraph{Our Contributions.}
In this paper, we thus lay the theoretical foundations for studying the interplay between \textit{dichotomous hedonic games} (DHGs) and the complexity of probabilistic inference. Motivated by probabilistic inference in voting games \cite{bachrach2011solving,imber2021probabilistic}, we propose \textit{random DHGs} (\textbf{RDHGs}), where each player has an independent participation probability. For various classes of DHGs, we explore the computational complexity of computing the probability that coalitions and partitions are either optimal, perfect or stable. We first examine coalitions and partitions that maximize the number of approving players within them. Then, we regard partitions which are either stable or {\em perfect} (where \textit{every} agent is in an approved coalition). We present cases that admit poly-time algorithms for some of these problems: when agents approve at most one coalition; when agents approve at most one coalition size; when agents are placed on a line and only approve intervals. Yet, the above problems become computationally hard (\#P-hard) when the setting becomes non-linear. Accordingly, we show cases where deciding whether the probability of optimality is nonzero can be computed in poly-time, and computing the probability of nonoptimality can be done up to a multiplicative approximation. Though DHGs are one of the very few sub-classes of hedonic games that admit poly-time solutions~\cite{peters2016complexity}, our results put this property of DHGs in question when it comes to a probabilistic setting.
%

Our model corresponds to counting variants of a \textit{\textbf{new}} type of manipulation in hedonic games: \textbf{\textit{constructive control by adding players}}. Analogous to election control problems \cite{bartholdi1992hard}, its goal is \textit{ensuring} that a specified outcome satisfies a certain solution concept by adding players. Unlike Sybil attacks~\cite{vallee2014study}, players are sincere and participate probabilistically. When players approve \textit{polynomially many} coalitions, we supply a reduction from control problems in elections with a polynomial and binary positional scoring rule. We are thus provided with a novel correlation between hedonic games and elections, from which we deduce some of our complexity results. The main complexity results are summarized in Table \ref{tab:complexity results on probabilistic inference}.
%

We then move our attention to \textit{majority games}, where agents form a graph and approve sets in which they are connected to the majority of other vertices. We classify the distribution of coalitions comprising perfect partitions and the social welfare incurred by them. We also explore this distribution in dynamic settings, where edges in the graph randomly and independently appear, via \textit{Erd\"{o}s-R\'{e}nyi graphs} \cite{erdos59random}. Regarding the standard measure of disutility caused by selfish behavior, \textit{Price of Anarchy} \cite{koutsoupias1999worst,elkind2016price}, we supply upper and lower bounds on the worst-case ratio between the (expected) social welfare of a partition maximizing it and that of a perfect one. %As a direct outcome, we supply upper and lower bounds on the \textit{(Expected) Price of Perfection} (PP) of a RDHG, i.e., the worst-case ratio between the (expected) social welfare of a partition maximizing it and that of a perfect one. PP is inspired by the standard measure of disutility caused by selfish behavior--\textit{Price of Anarchy}~\cite{koutsoupias1999worst,elkind2016price}.
%For Nash-stability, strict-core-stability and perfection, \#$\exists$CCAUP is \#P-hard in AHGs. Further, $\exists$CCAUP, deciding $Pr[\mathcal{NS}_{\mathcal{G}'}], Pr[\mathcal{SCS}_{\mathcal{G}'}], Pr[\mathcal{PF}_{\mathcal{G}'}] > 0$, are all NP-complete in AHGs.


% \begin{table*}
% \centering
% \begin{tabular}{lrrrrr}
% \toprule
% Class & $Pr[\mathcal{P}_{\mathcal{G}'}(\pi)]$ & $Pr[\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)]$ & $Pr[\mathcal{P}_{\mathcal{G}'}(\pi)]>0$ & $Pr[\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)]>0$ & $\approx Pr[\overline{\mathcal{P}_{\mathcal{G}'}(\pi)}]$ \\
% \midrule
% $1$-Lists & Poly-time & Poly-time & Poly-time & Poly-time & Poly-time \\
% $2$-Lists & \#P-hard & \#P-hard & Poly-time & Poly-time & FPRAS \\
% \bottomrule
% \end{tabular}
% \caption{Booktabs table}
% \label{tab:booktabs}
% \end{table*}

% In this paper, we study the computational complexity of probabilistic inference on questions related to optimal and stable outcomes in dichotomous hedonic games for various restrictions on agents’ dichotomous preferences.

\section{Related Work}
\label{sec:Related Work}
% A standard measure of disutility caused by selfish behavior is the \textit{Price of Anarchy}~\cite{koutsoupias1999worst}., i.e., the ratio of the social welfare in a socially optimal outcome and in a worst (social welfare-minimizing) Nash equilibrium of the game.
The study of hedonic games was initiated by Dreze and Greenberg \shortcite{dreze1980hedonic}, and later expanded to the study of characterizing various solutions concepts (concerning stability, perfection, and optimality), as well as many classes of hedonic games (See~\cite{aziz_savani_moulin_2016,woeginger2013core} for surveys on the topic). As mentioned earlier, hedonic games with dichotomous preferences are one natural, succinctly representable class proposed by Aziz et al. \shortcite{aziz2016boolean}, %, where each agent either approves or disapproves of a given coalition
who treat the exponential space requirement by representing agents’ preferences by propositional formulas, and thus term such games as \textit{Boolean hedonic games}. %They further show that such a restriction enables to express solution concepts by specific classes of formulas, which can then be solved by SAT solvers.
Peters \shortcite{peters2016complexity} thoroughly studied the complexity of finding optimal and stable partitions for various classes of DHGs.
%

Prior work on identifying solution concepts in hedonic games under uncertainty assumes the existence of user preference data over some coalition, which is then used to construct probably approximately stable outcomes (termed as \textit{PAC stability}). \cite{sliwinski2017learning,igarashi2019forming} aim at learning players' preferences from data and obtain a PAC approximation of the original hedonic game, and then finding a partition that PAC-stabilizes the approximate hedonic game. In contrast, Jha and Zick \shortcite{jha2020learning} focus on \textit{directly} learning a variety of economic solution concepts from data. We remark that this line of research relies on~\cite{balcan2015learning}, who focus on transferable utility (TU) cooperative games.
%

Built upon the notorious network reliability problem~\cite{provan1983complexity}, the \textit{reliability extension} of TU cooperative games are proposed by~\cite{bachrach2011solving,bachrach2012agent}, encapsulating the effects of independent agent failures. They show how to approximate the Shapley value in such games using sampling, and how to accurately compute the core in games with few agent types. They further show that applying the reliability extension may stabilize the game. \cite{bachrach2013reliability} extend this model to weighted voting games, and propose algorithms for computing the value of a coalition, finding stable payoff allocations, and estimating the power of agents. These studies are strictly contrasted to our own work, since hedonic games are with non-transferable utility.
%

Focusing on symmetric friend-oriented hedonic games, where players have strong favour towards their friends, Igarashi et al. \shortcite{igarashi2019robustness} explore how stability can be maintained even after any set of at most $k$ players leave their coalitions. They establish a \textit{robustness} concept, which is close to the notion of \textit{fault tolerance} in the theory of distributed systems~\cite{fedoruk2002improving}. Although their work is most similar to ours, our work differs considerably. First, to the best of our knowledge, no attempt has been ever made to connect hedonic games and probabilistic inference. We thus aim at making the first step towards bridging this gap. Further, we also consider uncertainty of agents’ friendships, instead of just their participation. Finally, we extend their model to a general probabilistic setting, whereas they concern participation in a uniform and deterministic sense. This extension is inspired by~\cite{imber2021probabilistic,wojtas2012possible}, who concern the problem of computing the probability of winning in an election where voter attendance is uncertain. In both papers, this task reduces to counting variants of election control problems \cite{bartholdi1992hard}, whose goal is ensuring that a preferred candidate is the winner by controlling the set of either voters or candidates. Particularly, we observe that similar control schemes arise in our own framework.

\section{Preliminaries}
\label{sec:Preliminaries}
For an integer $n > 0$, let $[n] := \{1,\dots,n\}$.
%\paragraph{Hedonic Games.}
A \textit{hedonic game} (HG) $\mathcal{G} = \langle N, (\succeq_i)_{i \in N} \rangle$ is given by a finite set $N = [n]$ of $n$ agents, with a complete and transitive preference relation $\succeq_i$ over $\mathcal{N}_i = \{C \subseteq N : i \in C\}$ for each agent $i \in N$. For each agent $i \in N$, we let $\succ_i$ and $\sim_i$ be the strict and indifference parts of $\succeq_i$ (resp.). The outcome of a hedonic game $\mathcal{G}$ is a \textit{partition} $\pi$ of $N$ into disjoint coalitions. Let $\pi(i)$ be the coalition $C \in \pi$ such that $i \in C$. In a \textit{dichotomous hedonic game} (DHG), agents only \textit{approve} or \textit{disapprove} coalitions, i.e., for each agent $i \in N$ there exists a utility function $v_i: \mathcal{N}_i \rightarrow \{0,1\}$ such that $\pi(i) \succeq_i \pi'(i)$ iff $v_i(\pi(i)) \geq v_i(\pi'(i))$. We use the convention that $v_i(C) = 0$ whenever $i \notin C$ for some $C \subseteq N$.
%



%for each agent $i \in N$, $\mathcal{N}_i$ can be partitioned into \textit{approved} coalitions $\mathcal{N}_i^+$ and \textit{disapproved} coalitions $\mathcal{N}_i^-$ such that $i$ strictly prefers approved coalitions to disapproved coalitions, but is indifferent within the two groups. Namely, $S \succ_i T$ iff $S \in \mathcal{N}_i^+$ and $T \in \mathcal{N}_i^+$

%is the utility $i$ received from $\pi$. %A partition $\pi$ is \textit{Pareto-optimal} if there is no partition $\pi'$ s.t. $\mu_i(\pi') \geq \mu_i(\pi)$ $\forall i \in N$ and $\mu_j(\pi') > \mu_j(\pi)$ for some $j \in N$.
%Particularly, welfare-optimal partitions are Pareto-optimal. A partition $\pi$ is \textit{individually rational} for $i$ if $\mu_i(\pi) \geq \mu_i(\{i\})$.

% \section{Random Dichotomous Hedonic Games}
% \label{sec:Random Dichotomous Hedonic Games}

% \paragraph{Probabilistic Participation of Players.}
Inspired by recent work on voting games~\cite{imber2021probabilistic}, %we formulate the \textit{random extension} for DHGs which assumes a random participation assumption. Namely,
we study a new variant of DHGs, referred to as \textit{Random DHGs} (\textbf{RDHGs}), where each agent has a \textit{fixed} and \textit{independent} participation probability for being \textit{randomly} drawn from $N$ and, hence, of having the opportunity for forming coalitions with the other participants. Sometimes, the participation probability of an agent is unknown, and we thus briefly discuss in Appendix A how it can be estimated (\textbf{Omitted and full proofs are available in \cite{supplementary}}). %Specifically, we study a new variant of DHGs, referred to as \textit{Random DHGs} (\textbf{RDHGs}), where agents \textit{independently} participate in the game by being \textit{randomly} drawn from $N$.
Formally, let $(p_i)_{i \in N} \in [0,1]^n$ be the \textit{probabilities}. Let $I \subseteq [n]$ be a random variable, where each $i \in N$ is in $I$ with probability $p_i$ and different indices are independent. The probability of $I$ being a subset $U \subseteq [n]$ is $Pr[I = U] = \prod_{i \in U} p_i \prod_{i \in [n] \setminus U} (1-p_i)$. The \textit{RDHG induced by a DHG $\mathcal{G}$} is thus $\mathcal{G}' = \langle N', (\succeq_i)_{i \in I} \rangle$, where the random set of players that participate in the game is $N' = I$. Agents won’t change their \textit{true} preferences over coalitions depending on the realization of the participants. Thus, agents (sincerely) value a coalition as if all its members were participating even if it is possible that they are not. That is, letting $v_i: \mathcal{N}_i \rightarrow \{0,1\}$ be agent $i$'s utility function in $\mathcal{G}$, her utility function $v_i': \mathcal{N}_i \rightarrow \{0,1\}$ in $\mathcal{G}'$ satisfies $v_i'(C) = v_i(C \cap I)$ for $C \in \mathcal{N}_i$. We note that $v_i'$ may differ from $v_i$ as there may be a coalition approved by agent $i$ in $G$ that is disapproved in the induced RDHG due to the participants' realizations.
%

%\paragraph{Solution Concepts.}
Given a partition or a coalition under our randomized setting, we redefine herein different measures of optimality and stability. Specifically, we largely follow the solution concepts investigated by~\cite{peters2016complexity}. %, as well as the common notion of popularity in hedonic games~\cite{brandt2020finding}. %, whereas ours refers to the popularity of \textit{coalitions}. We compare both notions in Appendix \ref{supp:popularity}.
% \paragraph{Welfare-Optimality.}
Given a partition $\pi$, a set $\mathcal{C}$ of coalitions and a subset of players $S \subseteq N$, the \textit{social welfare of a coalition $C \in \mathcal{C}$} in the game restricted to the players $S$ is $\mathcal{SW}_S(C) = \sum_{i \in C \cap S} v_i(C)$. $C \in \mathcal{C}$ is \textit{\textbf{welfare-optimal w.r.t. $\mathbf{\mathcal{C}}$ (WO$\mathbf{_\mathcal{C}}$)}} iff $C \in \argmax_{\tilde{C} \in \mathcal{C}} \mathcal{SW}_S(\tilde{C})$. The \textit{social welfare of $\pi$} is $\mathcal{SW}_S(\pi) = \sum_{C \in \pi} \mathcal{SW}_S(C)$. $\pi$ is \textit{\textbf{welfare-optimal (WO)}} iff $\pi \in \argmax_{\tilde{\pi}} \mathcal{SW}_S(\tilde{\pi})$.
%Given a partition $\pi$, the \textit{social welfare of a coalition $C \in \pi$} is $\mathcal{SW}(C) = \sum_{i \in C} v_i(C)$, which is \textit{welfare-optimal w.r.t. $\pi$} iff $C \in \argmax_{\tilde{C} \in \pi} \mathcal{SW}(\tilde{C})$. The \textit{social welfare of $\pi$} is $\mathcal{SW}(\pi) = \sum_{C \in \pi} \mathcal{SW}(C)$, which is \textit{welfare-optimal} iff $\pi \in \argmax_{\tilde{\pi}} \mathcal{SW}(\tilde{\pi})$. Thus, let $\mathcal{SW}_I(C) = \sum_{i \in C \cap I} v_i(C)$ and $\mathcal{SW}_I(\pi) = \sum_{C \in \pi} \mathcal{SW}_I(C)$ be the \textit{random} social welfare of $C$ and $\pi$ (resp.) in the corresponding RDHG $\mathcal{G}'$ for $C \subseteq N$ and a partition $\pi$ of $N$. %Whereas the common notion dictates that a partition is popular if there is no other partition that is preferred by a majority of the agents, ours concerns popularity
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \paragraph{Popularity.}
% Let $N_S(\pi,\pi')$ be the set of agents in $S \subseteq N$ who prefer $\pi$ over $\pi'$, i.e., $N_S(\pi,\pi') = \{i \in S: \pi(i) \succ_i \pi'(i)\}$, where $\pi$ and $\pi'$ are two partitions of $N$. On top of that, we define the \textit{popularity margin w.r.t. $S$} of $\pi$ and $\pi'$ as $\phi_S(\pi,\pi') = |N_S(\pi,\pi')| - |N_S(\pi',\pi)|$. Then, $\pi$ is called \textit{more popular} than $\pi'$ w.r.t. $S$ if $\phi_S(\pi,\pi') > 0$. Furthermore, $\pi$ is called \textit{\textbf{popular}} if, for all partitions $\pi'$, $\phi_S(\pi,\pi') \geq 0$, i.e., no partition is more popular than $\pi$. $\pi$ is called \textit{\textbf{strongly popular}} if, for all partitions $\pi'$, $\phi_S(\pi,\pi') > 0$, i.e., $\pi$ is more popular than every other partition. For two coalition $C$ and $C'$, we define $N_S(C,C')$ and $\phi_S(C,C')$ similarly to the above, as well as the corresponding popularity notions. Note that a popular partition or coalition does not necessarily exist. If there is strongly popular partition or coalition in any hedonic game, then it is \textit{unique}.
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Let $N(\pi,\pi')$ be the set of agents who prefer $\pi$ over $\pi'$, i.e., $N(\pi,\pi') = \{i \in N: \pi(i) \succ_i \pi'(i)\}$, where $\pi$ and $\pi'$ are two partitions of $N$. On top of that, we define the \textit{popularity margin} of $\pi$ and $\pi'$ as $\phi(\pi,\pi') = |N(\pi,\pi')| - |N(\pi',\pi)|$. Then, $\pi$ is called \textit{more popular} than $\pi'$ if $\phi(\pi,\pi') > 0$. Furthermore, $\pi$ is called \textit{popular} if, for all partitions $\pi'$, $\phi(\pi,\pi') \geq 0$, i.e., no partition is more popular than $\pi$. $\pi$ is called \textit{strongly popular} if, for all partitions $\pi'$, $\phi(\pi,\pi') > 0$, i.e., $\pi$ is more popular than every other partition. Note that there can be at most one strongly popular partition in any hedonic game. Under our randomized setting, given a pair $\pi$ and $\pi'$ of partitions, we let $N_I(\pi,\pi') = N(\pi,\pi') \cap I$ and denote the \textit{random} popularity margin by $\phi_I(\pi,\pi') =  |N_I(\pi,\pi')| - |N_I(\pi',\pi)|$. The popularity notions specified w.r.t. $\phi(\cdot, \cdot)$ can thus be readily applied to its random couterpart $\phi_I(\cdot, \cdot)$.
%
% \paragraph{Fairness and Stability.}
A partition $\pi$ is \textit{\textbf{perfect (PF)}} if \textit{every} agent is in an approved coalition in $\pi$. %A partition $\pi$ is \textit{\textbf{Pareto-optimal}} if there is no partition $\pi'$ s.t. $\pi'(i) \succeq_i \pi(i)$ for all $i$ and $\pi'(i) \succ_i \pi(i)$ for some $i$.
%For fairness, we refer to \textit{\textbf{envy-freeness}}: a partition $\pi$ is \textit{envy-free} if there is no agent $i$ has envy toward an agent $j$ with $\pi(i) \neq \pi(j)$, i.e., $(\pi(j) \setminus \{j\}) \cup \{i\} \succ_i \pi(i)$.
For stability, a partition $\pi$ is \textit{\textbf{core-stable}} if there is no non-empty coalition $C \subseteq N$ with $C \succ_i \pi(i)$ for all $i \in C$, and is \textit{\textbf{strict-core-stable (SCS)}} if there is no non-empty coalition $C\subseteq N$ with $C \succeq_i \pi(i)$ for all $i \in C$ and $C \succ_i \pi(i)$ for some $i \in C$. In both, a \textit{group of agents} may deviate. If we restrict our attention to the possibility of just a \textit{single agent} deviating, we obtain the notion of \textit{\textbf{Nash-stability (NS)}}. That is, $\pi(i) \succeq_i \pi(j) \cup \{i\}$ for all $i,j$ and $\pi$ is \textit{\textbf{individually rational (IR)}}, i.e., $\pi(i) \succeq_i \{i\}$ $\forall i$. %Further, an agent $i$ \textit{IS-deviates} into a coalition $S \in \pi \cup \{\emptyset\}$ if $S \succ_i \pi(i)$ and $\pi(j) \cup \{i\} \succeq_j \pi(j)$ for each $j \in S$. Thus, a partition is \textit{\textbf{individually stable}} if no agent IS-deviates.
% If $\pi(i) \succeq \{i\}$ for all $i$, then $\pi$ is \textit{\textbf{individually rational} (IR)}.
%

For a RDHG $\mathcal{G}'$, sets $\mathcal{C}$ and $\Pi$ of polynomially many coalitions and partitions (resp.), i.e., $|\mathcal{C}|$ and $|\Pi|$ are $O(\poly(n))$, a coalition $C \subseteq N$ and a partition $\pi$ of $N$, we define the following events under $\mathcal{G}'$ (while setting $S=I$ in $\mathcal{SW}_S$): %$\mathcal{P}^\Pi_{\mathcal{G}'}(\pi)$ denotes that $\pi$ is strongly popular w.r.t. $\Pi$; $\mathcal{P}^{\mathcal{C}}_{\mathcal{G}'}(C)$ denotes that $C$ is strongly popular w.r.t. $\mathcal{C}$;
$\mathcal{WO}_{\mathcal{G}'}^{\mathcal{C}}(C)$ denotes that $C \in \mathcal{C}$ is WO$_\mathcal{C}$; $\mathcal{WO}_{\mathcal{G}'}^{\Pi}(\pi)$ denotes that $\pi \in \Pi$ is WO$_\Pi$; $\mathcal{WO}_{\mathcal{G}'}$ denotes that there is a WO partition; $\overline{\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)}$ denotes that $C$ is \textit{not} WO$_\mathcal{C}$; %$\mathcal{WO}_{\mathcal{G}'}(C)$ denotes that $C$ is welfare-optimal w.r.t. \textit{all} coalitions; $\mathcal{WO}_{\mathcal{G}'}(\pi)$ denotes that $\pi$ is welfare-optimal;
$\mathcal{NS}_{\mathcal{G}'}(\pi)$ denotes that $\pi$ is NS; $\mathcal{NS}_{\mathcal{G}'}$ denotes that there is an NS partition; $\mathcal{PF}_{\mathcal{G}'}(\pi)$ denotes that $\pi$ is perfect; $\mathcal{PF}_{\mathcal{G}'}$ denotes that there is a perfect partition; %$\mathcal{IS}_{\mathcal{G}'}(\pi)$ denotes that $\pi$ is an individually stable partition;
$\mathcal{SCS}_{\mathcal{G}'}$ denotes that there is a strict-core-stable partition. When $\mathcal{C}$ and $\Pi$ are omitted, we refer to \textbf{\textit{all}} possible coalitions and partitions (resp.). Note that the events' dependence on a specific game $\mathcal{G}'$ quantifies the random set of players $I \subseteq [n]$ as defined for $\mathcal{G}'$.
%
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Throughout the paper, we consider the following problems which concern DHGs in their most general form, and are not restricted to a specific class of DHGs.
% \begin{problem}
% \label{problem:CCAUP}
% {\normalfont (Constructive Solution Concept by Players Addition -- \textbf{CCAUP})} We are given a DHG $\mathcal{G}$, a set of elements (either coalitions or partitions) $\mathcal{C}$, a set of players $\mathcal{M}$ that already participate in the DHG, a set $\mathcal{Q}$ of non-participating players, an element $C \in \mathcal{C}$, and a solution concept $\beta$ (e.g., popularity- or welfare-optimality, perfection, Nash-stability). We aim at selecting a set of players $\mathcal{Q}' \subseteq \mathcal{Q}$ s.t. $C$ satisfies the solution concept $\beta$ w.r.t. the set of players $\mathcal{M} \cup \mathcal{Q}'$.
% \end{problem}
% \begin{problem}
% \label{problem:hashtah-CCAUP} {\normalfont \textbf{\#CCAUP}:} The counting problem corresponding to {\normalfont CCAUP}, whose goal is counting the number of sets of players $\mathcal{Q}' \subseteq \mathcal{Q}$ s.t. $C$ satisfies $\beta$ w.r.t. the set of players $\mathcal{M} \cup \mathcal{Q}'$.
% \end{problem}
% % We consider the following variants of CCAUP:
% \begin{problem}
% \label{problem:exists-CCAUP}
% {\normalfont \textbf{$\exists$CCAUP}:} given $\mathcal{C}$, $\mathcal{M}$, $\mathcal{Q}$ and $\beta$ (as in Problem \ref{problem:CCAUP}), select a set of players $\mathcal{Q}' \subseteq \mathcal{Q}$ s.t. $\exists C \in \mathcal{C}$ that satisfies $\beta$ w.r.t. the set of players $\mathcal{M} \cup \mathcal{Q}'$. {\normalfont \textbf{\#$\exists$CCAUP}:} the counting problem corresponding to $\exists$CCAUP, whose goal is counting the number of \textbf{all} elements $C \in \mathcal{C}$ which satisfy $\beta$ w.r.t. the set of players $\mathcal{M} \cup \mathcal{Q}'$ for some $\mathcal{Q}' \subseteq \mathcal{Q}$.
% \end{problem}
% % \begin{problem}
% % \label{problem:set-exists-CCAUP}
% % For a set of players $\mathcal{Q}' \subseteq \mathcal{Q}$, let {\normalfont \textbf{\#$\exists$CCAUP-$\mathcal{Q}'$}} be the counting problem corresponding to {\normalfont $\exists$CCAUP}, whose goal is to count the number of elements $C \in \mathcal{C}$ which satisfy $\beta$ w.r.t. the set of players $\mathcal{M} \cup \mathcal{Q}'$.
% % \end{problem}

% We note the following crucial observation:
% \begin{observation}
% \label{observation:independent}
% Let $\mathcal{C}$ be a set of {\normalfont disjoint} coalitions. Since different players are independent, the random social welfares of any pair of \textit{disjoint} coalitions are independent, and thus different coalitions in $\mathcal{C}$ are independent.
% \end{observation}

% \begin{remark}
% \label{remark:computational-complexity}
% We recall that the class of counting variants of NP-problems is called {\normalfont \textbf{\#P}} and the class of functions computable in polynomial time is called {\normalfont \textbf{FP}}.
% \end{remark}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% \section{Controlling Outcomes in Hedonic Games}
% \label{sec:Controlling Outcomes in Hedonic Games}
\paragraph{Control Schemes.} Throughout the paper, our control schemes are inspired by prior studies on winners in elections \cite{bartholdi1992hard,hemaspaandra2007anyone,wojtas2012possible}. Specifically, we focus on \textit{constructive} control by \textit{adding} players, where the goal is \textit{ensuring} that a specified outcome satisfies a certain solution concept. Such a scheme can be employed by a central authority, which attempts to manipulate a DHG's outcome. Unlike prior studies on strategyproofness in hedonic games \cite{flammini2021strategyproof}, all players remain \textit{sincere} in their preferences. Note that the following problems are not restricted to a specific class of DHGs.

% \begin{definition}
% \label{definition:destructive}
% {\normalfont (Destructive)}
% The destructive variants {\normalfont \textbf{$\beta$-$\#$DCAP}} and {\normalfont \textbf{$\beta$-$\#$DCDP}} of the constructive problems {\normalfont $\beta$-$\#$CCAP} and {\normalfont $\beta$-$\#$CCDP} (resp.) are defined identically, except that our goal is that $C$ does \textbf{not} satisfy the solution concept $\beta$ with respect to the induced set of players.
% \end{definition}
\begin{problem}
\label{problem:constructive}
% {\normalfont (Constructive)}
We are given a DHG $G$, a set of elements (either coalitions or partitions) $\mathcal{C}$, a set of players $\mathcal{M}$ that already participate, a set $\mathcal{Q}$ of non-participating players, an element $C \in \mathcal{C}$ and a solution concept $\beta$ (e.g., welfare-optimality, perfection, Nash-stability). In our model, when a random set of players is drawn, there is no restriction on the number of players. Thus, in constructive control by adding an \textbf{unbounded} number of players {\normalfont (\textbf{$\beta$-$\#$CCAUP})} the goal is counting the number of sets $\mathcal{Q}' \subseteq \mathcal{Q}$ such that $C$ satisfies the solution concept $\beta$ w.r.t. the set of players $\mathcal{M} \cup \mathcal{Q}'$.
% \begin{enumerate}
%     \item In constructive control by adding an unlimited number of adding players {\normalfont (\textbf{$\beta$-CCAUP})}, the goal is counting the number of sets of players $\mathcal{Q}' \subseteq \mathcal{Q}$ such that $C$ satisfies the solution concept $\beta$ with respect to the set of players $\mathcal{M} \cup \mathcal{Q}'$, where $|\mathcal{Q}'| \leq m$.
%     \item In constructive control by deleting players {\normalfont (\textbf{$\beta$-$\#$CCUDP})}, the goal is counting the number of sets of players $\mathcal{M}' \subseteq \mathcal{M}$ such that $C$ satisfies the solution concept $\beta$ with respect to the set of players $\mathcal{M} \setminus \mathcal{M}'$, where $|\mathcal{M}'| \leq m$.
% \end{enumerate}
\end{problem}

% \begin{problem}
% \label{problem:CCAUP}
% {\normalfont (Constructive Solution Concept by Players Addition -- \textbf{CCAUP})} We are given a DHG $\mathcal{G}$, a set of elements (either coalitions or partitions) $\mathcal{C}$, a set of players $\mathcal{M}$ that already participate in the DHG, a set $\mathcal{Q}$ of non-participating players, an element $C \in \mathcal{C}$, and a solution concept $\beta$ (e.g., popularity- or welfare-optimality, perfection, Nash-stability). We aim at selecting a set of players $\mathcal{Q}' \subseteq \mathcal{Q}$ s.t. $C$ satisfies the solution concept $\beta$ w.r.t. the set of players $\mathcal{M} \cup \mathcal{Q}'$.
% \end{problem}
% We consider the following variants of CCAUP:
\begin{problem}
\label{problem:exists-CCAUP}
% {\normalfont \textbf{$\exists$CCAUP}:} given $\mathcal{C}$, $\mathcal{M}$, $\mathcal{Q}$ and $\beta$ (as in Problem \ref{problem:CCAUP}), select a set of players $\mathcal{Q}' \subseteq \mathcal{Q}$ s.t. $\exists C \in \mathcal{C}$ that satisfies $\beta$ w.r.t. the set of players $\mathcal{M} \cup \mathcal{Q}'$.
{\normalfont \textbf{$\beta$-\#$\exists$CCAUP}:} given $\mathcal{C}$, $\mathcal{M}$, $\mathcal{Q}$ and $\beta$, the goal is counting the number of \textbf{all} subsets $\mathcal{Q}' \subseteq \mathcal{Q}$ s.t. there exists some $C \in \mathcal{C}$ that satisfies $\beta$ w.r.t. the set of players $\mathcal{M} \cup \mathcal{Q}'$.
\end{problem}
\begin{problem}
\label{problem:Decision}
{\normalfont (Decision Variants)}
Let {\normalfont $\beta$-$\# \mathcal{P}$} be one of the counting problems in Problems \ref{problem:constructive}--\ref{problem:exists-CCAUP}. In the decision problem {\normalfont \textbf{$\beta$-$\mathcal{P}$}} corresponding to {\normalfont $\beta$-$\#\mathcal{P}$}, instead of asking for a particular quantity w.r.t. to a solution concept $\beta$ we ask if that quantity is greater than zero.
\end{problem}
\begin{problem}
\label{problem:bounded}
For each problem {\normalfont $\mathcal{P}$} in Problems \ref{problem:constructive}-\ref{problem:Decision}, in the problem {\normalfont $\mathcal{P}$-$m$} we bound the number of selected players by a nonegative integer $m \in \mathbb{N}$.
\end{problem}
% \begin{remark}
% \label{remark:computational-complexity}
We recall that the class of counting variants of NP-problems is called {\normalfont \textbf{\#P}} and the class of functions computable in polynomial time is called {\normalfont \textbf{FP}}. %For additional notions regarding the complexity theory of counting problem, readers may refer to \cite{wojtas2012possible}. %Further, for two counting problems \#A and \#B, \#A \textit{\textbf{Turing reduces}} \#B if there exists a poly-time algorithm that solves \#A given oracle access to \#B. \textbf{\#P-Turing-completeness} is defined similarly. For additional notions regarding the complexity theory of counting problem, reader may refer to \cite{wojtas2012possible}.
% \end{remark}
% \begin{remark}
% \label{remark:bounded}
% \end{remark}
% \begin{problem}
% \label{problem:set-exists-CCAUP}
% For a set of players $\mathcal{Q}' \subseteq \mathcal{Q}$, let {\normalfont \textbf{\#$\exists$CCAUP-$\mathcal{Q}'$}} be the counting problem corresponding to {\normalfont $\exists$CCAUP}, whose goal is to count the number of elements $C \in \mathcal{C}$ which satisfy $\beta$ w.r.t. the set of players $\mathcal{M} \cup \mathcal{Q}'$.
% \end{problem}
We also note the following:
\begin{corollary}
\label{corollary:independent}
Let $\mathcal{C}$ be a set of {\normalfont disjoint} coalitions. Since different players are independent, the random social welfares of any pair of \textit{disjoint} coalitions are independent, and thus different coalitions in $\mathcal{C}$ are independent.
\end{corollary}

\section{Reductions from CCAUP to RDHGs}
Throughout our work, hardness results are derived from the following reductions from Problems \ref{problem:constructive}--\ref{problem:bounded} to RDHGs.
\begin{lemma}
\label{lemma:connection coalitions}
%{\normalfont \textbf{(The Connection of $\beta$-\#CCAUP for coalitions to RDHG)}}
There is a reduction from $\beta$-\#CCAUP for coalitions to computing the probability that a coalition satisfies $\beta$. Thus, \#P-completeness of $\beta$-\#CCAUP implies \#P-hardness of computing the mentioned probability.
\end{lemma}
\begin{proof}
Adapting the approach in Subsection 3.2 of \cite{imber2021probabilistic}, let $\mathcal{G}$, $\mathcal{C}$, $\mathcal{M}$, $\mathcal{Q}$ and $C \in \mathcal{C}$ be an instance of $\beta$-\#CCAUP, where $\mathcal{C}$ contains polynomially many \textit{disjoint} coalitions. The players in $\mathcal{M}$ participate with probability $1$, whereas those in $\mathcal{Q}$ participate with probability $1/2$. Let $|\mathcal{Q}| := m$ and $\alpha(\mathcal{M}, \mathcal{Q})$ be the number of subsets $\mathcal{Q}' \subseteq \mathcal{Q}$ s.t. $C$ satisfies $\beta$ w.r.t. $\mathcal{M} \cup \mathcal{Q}'$. Corollary \ref{corollary:independent} yields that the probability that a coalition satisfies $\beta$ equals to $2^{-m} \alpha(\mathcal{M}, \mathcal{Q})$, which concludes the proof.
\end{proof}

\begin{lemma}
\label{lemma:connection partitions}
% {\normalfont \textbf{(The Connection of $\beta$-$\exists$CCAUP for partitions to RDHG)}}
There is a reduction from $\beta$-$\exists$CCAUP for partitions to deciding the zeroness of the probability that there exists a partition satisfying $\beta$. Thus, NP-completeness of $\beta$-$\exists$CCAUP implies NP-hardness of the later.
\end{lemma}
\begin{proof}
Let $\mathcal{G}$, $\mathcal{C}$, $\mathcal{M}$, $\mathcal{Q}$ be an instance of $\exists$CCAUP for partitions. The players in $\mathcal{M}$ participate with probability $1$ and those in $\mathcal{Q}$ participate with probability $1/2$. Clearly, the CCAUP instance admits a solution iff the probability that the constructed RDHG $\mathcal{G}'$ admits a $\beta$ partition is positive.
\end{proof}

Thus, we hereafter focus on $\beta$-\#CCAUP and $\beta$-$\exists$CCAUP for the sake of analyzing the complexity of probabilistic inference under RDHGs.

% \begin{observation}
% \label{observation:implications}
% \cite{barrot2019stable,brandt2022single} supply implications between stability and other concepts. Thus, for a concept $\alpha$ that also satisfies a concept $\beta$, an hardness result for $\beta$ implies hardness for $\alpha$.
% \end{observation}


% In the sequel, we analyze the computational complexity of the above problems for various classes of DHGs, which in turn serves as the barrier to manipulation. That is, for a solution concept $\beta$ and some class of DHGS, we say that this class is (\textit{computationally}) \textit{vulnerable} w.r.t. $\beta$ under a control problem if there is a polynomial-time algorithm for control problem. Otherwise, we say that it is (\textit{computationally}) \textit{resistant} if this task is computationally hard (\#P-hard) (or NP-complete for the decision variants in Definition \ref{definition:Decision}).

% \paragraph{DHGs with $k$-Lists.}

% \paragraph{DHGs with Candidate Intervals (CIs).}

% \paragraph{Majority Games.}

% \section{Computing the Probability of Optimality}
% \label{sec:Computing the Probability of Optimality}
% First, we prove that $Pr[\mathcal{P}_{\mathcal{G}'}(\pi)]$, $Pr[\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)]$ are computable in poly-time for $1$-lists, but are \#P-hard for $k$-lists with $k \geq 2$ (Subsection \ref{sec:DHGs with $k$-Lists}). In contrast, we prove that even $Pr[\mathcal{M}^\star_{\mathcal{G}'}(\pi)]$ is always computable in poly-time for candidate intervals (Subsection \ref{sec:DHGs with Candidate Intervals}).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \section{\#P-Hardness of Popularity in Hedonic Games}
% \label{sec:P-Hardness of Popularity in Hedonic Games}
% For popularity of either partitions or coalitions, we initiate with general \#P-hardness results for \textbf{any} hedonic game. Intuitively, a partition is strongly popular if it is preferred to every other partition by some majority of agents. Strong popularity thus corresponds to the notion of \textit{strong Condorcet winners} in social choice theory \cite{gehrlein2001condorcet}, in the voting instance where players are voters and all feasible partitions are the candidates. Theorem 3.7 of \cite{imber2021probabilistic} proves that it is \#P-hard to compute the probability that a certain candidate is a Condorcet winner
% \begin{theorem}
% \label{theorem:perfect-intractable}
% In {\normalfont any} hedonic game, computing $Pr[\mathcal{P}_{\mathcal{G}'}(\pi)]$ and $Pr[\mathcal{P}_{\mathcal{G}'}(C)]$ are both \#P-hard.
% \end{theorem}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\section{Hedonic Games with $\poly(n)$-Lists}
\label{sec:DHGs with $k$-Lists}
Peters~\shortcite{peters2016complexity} refers to a context where agents only approve \textit{polynomially many} coalitions, and thus their preferences can be represented by merely listing all approved coalitions. In an even more restricted variant, the $k$-lists representation is considered, where each agent submits a list of \textit{at most} a constant number of $k \in \mathbb{N}$ approved coalitions. In this section, we therefore explore the complexity of probabilistically inferring optimality in $k$-lists. We first investigate the complexity of computing the probabilities concerning welfare-optimal coalitions/partitions. Provided that it is \#P-hard for $k$-lists with $k \geq 2$ (Theorem \ref{theorem:CCAUP-computationally-hard}), we discuss their approximability. Finally, we prove that deciding the zeroness of the probability that there exists a SCS partition is NPC even for $1$-lists (Theorem \ref{theorem:strict-core-stable}). Note that a hardness result for $1$-lists also applies to $k$-lists with $k \geq 2$ (or even $\poly(n)$-lists). %we prove that computing the probability that there exists a perfect partition ($Pr[\mathcal{PF}_{\mathcal{G}'}]$) or a Nash-stable partition ($Pr[\mathcal{NS}_{\mathcal{G}'}]$) is generally \#P-hard even for $2$-lists (Theorem \ref{theorem:perfect-2-lists-set}).

%
\subsection{Probability of Welfare-Optimality}
\label{sec:Probability of Optimality}
For $1$-lists, we prove that the probability that a coalition is welfare-optimal w.r.t. either a set $\mathcal{C}$ or a set $\Pi$ of polynomially many coalitions and partitions (resp.), %or \textit{all} possible coalitions can be computed in poly-time for $1$-lists.
%For partitions, we obtain similar results w.r.t. to a set $\Pi$ of polynomially many partitions.
and \#CCAUP for welfare-optimal coalitions are poly-time computable.
\begin{theorem}
\label{theorem:max-tractable}
Computing $Pr[\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)]$, $Pr[\mathcal{WO}_{\mathcal{G}'}^{\Pi}(\pi)]$, as well as solving \#CCAUP(-$m$) (Problems \ref{problem:constructive}, \ref{problem:bounded}) for welfare-optimal coalitions, can all be done in poly-time for $1$-lists.
\end{theorem}
\begin{proof}
(\textit{Sketch}) Note that $Pr[\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)] = \sum_{j=0}^{n} Pr[\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C) \cap \mathcal{SW}_I(C) = j] = \sum_{j=0}^n Pr\big[\mathcal{SW}_I(C) = j \cap [\cap_{C \neq C' \in \mathcal{C}} \mathcal{SW}_I(C') \leq j]\big]$. If $\mathcal{C}$ contains only \textit{disjoint} coalitions (i.e., $C \cap C' = \emptyset$ for any pair $C \neq C'$ in $\mathcal{C}$), then Corollary \ref{corollary:independent} can be invoked. Hence, this assumption drastically simplifies the proof, as discussed in Appendix B. Yet, we herein consider the more general case where this assumption is \textit{\textbf{not}} necessarily satisfied.
%

\begin{algorithm}[tb]
\caption{Computing $\mathcal{L}(n,\{q_m\}_{m \in [M]})$}
\label{alg:poly many}
\begin{algorithmic}[1] %[1] enables line numbers
\STATE $\mathcal{L}(0,\{0\}_{m \in [M]}) = 0$
\STATE $\mathcal{L}(0,\{q_m\}_{m \in [M]}) = 1$ ($q_m \neq 0$ $\forall m \in [M]$)
\FOR{$j=1$ to $n$}
\IF {$\exists \tilde{m} \in [M]$ s.t. $v_j(C_{\tilde{m}}) = 1$}
\STATE $\mathcal{L}(j,\{q_m\}_{m \in [M]}) = p_j \mathcal{L}(j-1,\{q_m\}_{\tilde{m} \neq m \in [M]} \cup \{q_{\tilde{m}} - 1\}) + (1-p_j) \mathcal{L}(j-1,\{q_m\}_{m \in [M]})$
\ELSE
\STATE $\mathcal{L}(j,\{q_m\}_{m \in [M]}) = \mathcal{L}(j-1,\{q_m\}_{m \in [M]})$
\ENDIF
\ENDFOR
\STATE \textbf{return} $\mathcal{L}(n,\{q_m\}_{m \in [M]})$
\end{algorithmic}
\end{algorithm}

% \begin{equation}
%     \label{eq:final-poly-many}
%     \mathcal{L}(j,\{q_m\}_{m \in [M]}) =
%     \begin{cases}
%     p_j \mathcal{L}(j-1,\{q_m\}_{\tilde{m} \neq m \in [M]} \cup \{q_{\tilde{m}} - 1\}) \\ + (1-p_j) \mathcal{L}(j-1,\{q_m\}_{m \in [M]}), \\ \text{ if } v_j(C_{\tilde{m}}) = 1 \text{ for some } \tilde{m} \in [M]\\ \\
%     \mathcal{L}(j-1,\{q_m\}_{m \in [M]}), \text{ otherwise}
%     \end{cases}
% \end{equation}
%Let $j \geq 1$. If $v_j(C_m) = 0$ for each $m \in [M]$ or $j \notin I$, then agent $j$ does not affect the value of $\mathcal{SW}_I(C_m)$, and thereby $\mathcal{L}(j,\{q_m\}_{m \in [M]}) = \mathcal{L}(j-1,\{q_m\}_{m \in [M]})$. If $v_j(C_{\tilde{m}}) = 1$ for some $\tilde{m} \in [M]$, then two cases are possible: the event $\sum_{i \in I \cap [j]} v_i(C_{\tilde{m}}) = q_{\tilde{m}}$ is equivalent to $\sum_{i \in I \cap [j - 1]} v_i(C_{\tilde{m}}) = q_{\tilde{m}} - 1$ if $j \in I$, and $\sum_{i \in I \cap [j - 1]} v_i(C_{\tilde{m}}) = q_{\tilde{m}}$ otherwise. Since we are considering $1$-lists, there is at most $1$ such $\tilde{m}$. We conclude that $\mathcal{L}(j,\{q_m\}_{m \in [M]}) = p_j \mathcal{L}(j-1,\{q_m\}_{\tilde{m} \neq m \in [M]} \cup \{q_{\tilde{m}} - 1\}) + (1-p_j) \mathcal{L}(j-1,\{q_m\}_{m \in [M]})$ if $v_j(C_{\tilde{m}}) = 1$ for some $\tilde{m} \in [M]$; otherwise, $\mathcal{L}(j,\{q_m\}_{m \in [M]}) = \mathcal{L}(j-1,\{q_m\}_{m \in [M]})$.

Thus, we depict how $Pr\big[\mathcal{SW}_I(C) = q \cap [\cap_{C \neq C' \in \mathcal{C}} \mathcal{SW}_I(C') \leq q]\big]$ can be computed in poly-time for any integer $0 \leq q \leq n$ and coalition $C \in \mathcal{C}$. We denote $\mathcal{C} := \{C_1, \dots, C_M\}$, where $M = O(\poly(n))$ by our assumption. For integers $j \in [n]$, $0 \leq q_m \leq n$ ($m \in [M]$), let $\mathcal{L}(j,\{q_m\}_{m \in [M]}) = Pr\big[\cap_{m \in [M]} \sum_{i \in I \cap [j]} v_i(C_m) = q_m \big]$ (Recall that $v_i(C_m) = 0$ if $i \notin C_m$). In Appendix C, we observe that it can be computed in poly-time via the dynamic program in Algorithm \ref{alg:poly many}. Note that $\mathcal{L}(n,\{q_m\}_{m \in [M]})$ is the desired probability. By summing these values, we can thus readily compute $Pr[\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)]$ as described above. Computing $Pr[\mathcal{WO}_{\mathcal{G}'}^{\Pi}(\pi)]$ is via similar arguments, and thus deferred to Appendix D. Solving either \#CCAUP-$m$ or \#CCAUP for welfare-optimal coalitions is by slightly modifying the proof of Theorem 6 in \cite{wojtas2012possible}, which is thereby illustrated in Appendix E.
\end{proof}

% From Theorem \ref{theorem:max-tractable}, we obtain that computing the probability that a partition $\pi$ is \textit{individually rational} for $i$ (i.e., $\mu_i(\pi) \geq \mu_i(\{i\})$) is also computable in poly-time for $1$-lists:
% \begin{corollary}
% Computing the probability that a partition $\pi$ is \textit{individually rational} for each agent $i$ is in FP for $1$-lists.
% \end{corollary}

In contrast to Theorem \ref{theorem:max-tractable}, computing $Pr[\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)]$ is generally intractable for $k$-lists with $k \geq 2$. Initially, we supply a generic reduction from winner elections to $\poly(n)$-lists (See Appendix F.1 for a brief on voting games).
\begin{theorem}
\label{theorem:reduction}
There exists a poly-time reduction from each control problem in elections with a polynomial and binary positional scoring rule to its parallel control problem in $\poly(n)$-lists under welfare-optimal coalitions.
\end{theorem}
\begin{proof}
(\textit{Sketch})
The proof is for control by \textit{adding} players only. When \textit{deleting} players, the proof similarly follows via the same reduction. Let $r$ be a scoring rule, $\mathcal{C}$ be a set of candidates, $\mathcal{M} := \{M_{i_1}, \dots, M_{i_{h_1}}\}$ and $\mathcal{Q} := \{Q_{j_1}, \dots, Q_{j_{h_2}}\}$ be a voting profile of the registered and unregistered voters (resp.), and $c \in \mathcal{C}$ be a preferred candidate. If $T_i$ is voter $v_i$'s ranking, then $s(T_i, c, r)$ is the score that the voter $i$ contributes to a candidate $c$ under $r$. We construct a DHG in $\poly(n)$-lists form as follows. Let $\tilde{\mathcal{M}} := \mathcal{M} \cup \mathcal{C}$ and $\tilde{\mathcal{Q}} := \mathcal{Q}$ be the sets of participating and non-participating players (resp.). For each candidate $d \in \mathcal{C}$, we construct a coalition $U_d$ containing $d$ and all voters $v_{i_{\ell_1}}$ and $v_{j_{\ell_2}}$ ($\ell_1 \in [h_1], \ell_2 \in [h_2]$), which approve $d$. Formally, $U_d = \tilde{\mathcal{M}}_d \cup \tilde{\mathcal{Q}}_d \cup \{d\}$ with $\tilde{\mathcal{M}}_d = \{v_{i_{\ell_1}} : s(M_{\ell_1}, c, r) = 1 \}$ and $\tilde{\mathcal{Q}}_d = \{v_{j_{\ell_2}} : s(Q_{\ell_2}, c, r) = 1\}$. Each candidate $d$ submits an empty list and each voter $v_i$ in the constructed hedonic game approves all coalitions $U_d$ for which $v_i \in U_d$. Since $v_i \in U_d$ if and only if $v_i$ approved the candidate $d$, then each player in the constructed hedonic game approves $\poly(n)$ many coalitions as $r$ is a polynomial scoring rule. Thus, the reduction is well-defined. Finally, let $\tilde{\mathcal{C}} = \{U_d\}_{d=1}^m$ be the set of all possible coalitions and consider $U_c$ as the preferred coalition. In Appendix F.2, we prove that every subset of voters $\mathcal{Q}' \subseteq \mathcal{Q}$ s.t. $c$ is a winner of $\mathcal{M} \circ \mathcal{Q}'$ under $r$ corresponds one-to-one to a subset of players $\tilde{\mathcal{Q}}' \subseteq \tilde{\mathcal{Q}}$ s.t. $U_c$ is welfare-optimal w.r.t. $\tilde{\mathcal{M}} \cup \tilde{\mathcal{Q}}'$.
% See Appendix ?? for a detailed proof.
\end{proof}

Theorem \ref{theorem:reduction} thus enables us to transfer prior results on controlling elections to hedonic games. Theorem \ref{theorem:CCAUP-computationally-hard} illustrates its application to welfare-optimal coalitions. An alternate proof for $k$-lists ($k \geq 2$) appears in Appendix G. % Other solution scenarios are discussed in Theorem \ref{theorem:CCAUP-computationally-hard-other-solution-concepts}.
\begin{theorem}
\label{theorem:CCAUP-computationally-hard}
In both $k$-lists ($k \geq 2$) and $\poly(n)$-lists, if $\mathcal{C}$ contains polynomially many \textit{disjoint} coalitions, then \#CCAUP for welfare-optimal coalitions and computing $Pr[\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)]$ are \#P-hard. %Further, computing  is \#P-hard for $k$-lists with $k \geq 2$.
\end{theorem}
\begin{proof}
% (\textit{Sketch}) %For a fixed $k \geq 2$, the proof for \#CCAUP is by reduction from counting the (not necessarily perfect) matchings in a graph, known to be $\#P$-complete \cite{valiant1979complexity}. The proof is deferred to Appendix \ref{supp:computational-hardness-CCAUP}.
%
For a fixed $k \geq 2$, Theorem \ref{theorem:reduction} provides a reduction to \#CCAUP for welfare-optimal coalitions from constructive control by adding an unlimited number of voters (\#CCUAV) under $k$-approval, which is \#P-hard due to Theorem 3.2 in \cite{imber2021probabilistic}. For $\poly(n)$-lists, Theorem \ref{theorem:reduction} provides a reduction to \#CCAUP for welfare-optimal coalitions from \#CCUAV under approval voting, which is \#P-hard due to Theorem 13 in \cite{wojtas2012possible}. %Adapting the approach in Subsection 3.2 of~\cite{imber2021probabilistic}, the proof for computing $Pr[\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)]$ is by reduction from \#CCAUP. Let $\mathcal{G}$, $\mathcal{C}$, $\mathcal{M}$, $\mathcal{Q}$ and $C \in \mathcal{C}$ be an instance of \#CCAUP under welfare-optimal coalitions, where $\mathcal{C}$ contains polynomially many \textit{disjoint} coalitions. The players in $\mathcal{M}$ participate with probability $1$, whereas those in $\mathcal{Q}$ participate with probability $1/2$. Let $|\mathcal{Q}| := m$ and $\alpha(\mathcal{M}, \mathcal{Q})$ be the number of subsets $\mathcal{Q}' \subseteq \mathcal{Q}$ s.t. $C$ is welfare-optimal w.r.t. $\mathcal{M} \cup \mathcal{Q}'$.
By Lemma \ref{lemma:connection coalitions}, computing $Pr[\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)]$ is \#P-hard.
\end{proof}
% \begin{theorem}
% \label{theorem:CCAUP-computationally-hard-other-solution-concepts}

% \end{theorem}
% \begin{remark}
% \label{remark:populaity}
% {\normalfont(Popularity)} We note that Theorem \ref{theorem:reduction} yields a reduction to \#CCAUP for {\normalfont strongly popular partitions} \cite{brandt2020finding} from \#CCUAV under Condorcet \cite{gehrlein2001condorcet}, which is \#P-hard due to Theorem 3.4 in \cite{imber2021probabilistic}. %Intuitively, a partition is strongly popular if it is preferred to every other partition by some majority of agents. Strong popularity thus corresponds to the notion of \textit{strong Condorcet winners} in social choice theory, in the voting instance where players are voters and all feasible partitions are the candidates.
% \end{remark}

Despite Theorem \ref{theorem:CCAUP-computationally-hard}, it appears that verifying $Pr[\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)]$'s zeroness can be done in poly-time:
\begin{theorem}
\label{theorem:zeroness}
In $k$-lists ($k \geq 2$) and $\poly(n)$-lists% where each agent approves of exactly $k$ coalitions
, then CCAUP for welfare-optimal coalitions (partitions) and deciding $Pr[\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)] > 0$ ($Pr[\mathcal{WO}^{\Pi}_{\mathcal{G}'}(\pi)] > 0$) are in FP.
\end{theorem}
\begin{proof}
Let $\mathcal{G}$, $\mathcal{C}$, $\mathcal{M}$, $\mathcal{Q}$ and $C \in \mathcal{C}$ be an instance of CCAUP. Let $\mathcal{Q}^\star \subseteq \mathcal{Q}$ be the set of all players which approve the coalition $C$. Let $\mathcal{Q}' \subseteq \mathcal{Q}$ s.t. $C$ is welfare-optimal w.r.t. $\mathcal{M} \cup \mathcal{Q}'$. Then, $C$ is welfare-optimal w.r.t. $\mathcal{M} \cup \mathcal{Q}^\star$, and thus verifying this property is sufficient for deciding whether $Pr[\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)] > 0$. Indeed, for each $i \in \mathcal{Q}^\star \setminus \mathcal{Q}'$, adding $i$ to $\mathcal{M} \cup \mathcal{Q}'$ increases the social welfare of $C$ by $1$, and the social welfare of any other coalition increases by at most $1$. Thus, $C$ is welfare-optimal w.r.t $\mathcal{M} \cup \mathcal{Q}''$, where $  \mathcal{Q}'' := \mathcal{Q}' \cup \mathcal{Q}^\star$. Since the players in $ \mathcal{Q}'' \setminus  \mathcal{Q}^\star$ disapprove $C$ and the social welfare of the other coalitions cannot increase, $C$ remains welfare-optimal even after removing them from $\mathcal{M} \cup \mathcal{Q}''$. Hence, $C$ is welfare-optimal w.r.t $\mathcal{M} \cup \mathcal{Q}^\star$. The proof for $Pr[\mathcal{WO}^{\Pi}_{\mathcal{G}'}(\pi)] > 0$ is by similar arguments.
\end{proof}

\begin{remark}
If we set $\mathcal{C} = \{C' \subseteq N : \exists i \in I \text{ s.t. } v_i(C) = 1\}$ and note that $|\mathcal{C}| \leq kn$, the results for computing $Pr[\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)]$ also apply to computing $Pr[\mathcal{WO}_{\mathcal{G}'}(C)]$.
\end{remark}


Though Theorems \ref{theorem:max-tractable} and \ref{theorem:zeroness} provided positive results, when attending to welfare-optimal \textit{partitions} among \textbf{\textit{all}} possible ones we achieve the following \textit{negative} result for $1$-lists.
\begin{theorem}
\label{theorem:max-intractable}
In $1$-lists, \#$\exists$CCAUP for welfare-optimal partitions w.r.t. $\Pi$ is \#P- and \#W[1]-hard. Further, deciding $Pr[\mathcal{WO}_{\mathcal{G}'}] > 0$ and $\exists$CCAUP for welfare-optimal partitions are NPC and W[1]-hard.
\end{theorem}
\begin{proof}
(\textit{Sketch}) Adapting the reduction in Theorem 5 of~\cite{peters2016complexity}, we show a reduction to \#$\exists$CCAUP for welfare-optimal partitions of partitions from \#INDEPENDENT-SET (\#IS), known to be \#P-complete in general \cite{provan1983complexity}. Given a graph $G = (V,E)$ and a target size $k$, we choose $\mathcal{M} = E$ and $\mathcal{Q} = V$ as the participating and the non-participating players (resp.). Each edge player $e \in E$ submits an empty list: she does not approve any coalition. A vertex player $v \in V$ approves $A_v := \{v\} \cup \{e \in E : v \in e\}$, i.e., $v$ approves being together with the edges incident to it.  In Appendix H, we prove that each independent set of size $\geq k$ corresponds one-to-one to a subset of players $\mathcal{Q}' \subseteq \mathcal{Q}$ and a partition $\pi$ such that $\mathcal{SW}_{N'}(\pi) \geq k$ w.r.t. $N' = \mathcal{M} \cup \mathcal{Q}'$, thus providing us with a poly-time reduction. Our construction also supplies a reduction from INDEPENDENT-SET to CCAUP. By Lemma \ref{lemma:connection partitions}, deciding $Pr[\mathcal{WO}_{\mathcal{G}'}] > 0$ is \#P-hard. %For deciding $Pr[\mathcal{WO}_{\mathcal{G}'}(\pi)] > 0$, we reduce from $\exists$CCAUP. Let $\mathcal{G}$, $\mathcal{C}$, $\mathcal{M}$, $\mathcal{Q}$ and $\pi \in \mathcal{C}$ be an instance of $\exists$CCAUP under welfare-optimal partitions, where $\mathcal{C}$ is the set of \textit{all} possible partitions. The players in $\mathcal{M}$ participate with probability $1$, whereas those in $\mathcal{Q}$ participate with probability $1/2$. Clearly, the CCAUP instance admits a solution iff $Pr[\mathcal{WO}_{\mathcal{G}'}(\pi)] > 0$ in the constructed RDHG $\mathcal{G}'$.
Since \#IS and IS are \#W[1]- and W[1]-hard \cite{downey1995fixed,curticapean2019fixed}, respectively, the reduction also provides us with W[1]-hardness results where the parameter is the number of approving agents. %The proof for computing $Pr[\mathcal{WO}_{\mathcal{G}'}(\pi)]$ is by reduction from \#CCAUP for welfare-optimal partitions. Let $\mathcal{G}$, $\mathcal{C}$, $\mathcal{M}$, $\mathcal{Q}$ and $C \in \mathcal{C}$ be an instance of \#CCAUP under welfare-optimal partitions with $|\mathcal{Q}| := m$. The players in $\mathcal{M}$ participate with probability $1$, whereas those in $\mathcal{Q}$ participate with probability $1/2$. Let $\alpha(\mathcal{M}, \mathcal{Q})$ be the number of subsets $\mathcal{Q}' \subseteq \mathcal{Q}$ s.t. $\pi$ is welfare-optimal w.r.t. $\mathcal{M} \cup \mathcal{Q}'$. Though players are independent, this does not extend to different partitions.
\end{proof}


% However, for the following restrictions \#CCAUP for welfare-optimality of partitions. As a corollary, we further obtain that counting the number of welfare-optimal partitions in such a restricted DHG can be done in poly-time.
% \begin{theorem}
% \label{theorem:max-poly}
% In $2$-lists where each agent either approves a single coalition of size $2$ or disapproves all coalitions, \#CCAUP for partitions' welfare-optimality is in FP.
% \end{theorem}
% \begin{proof}
% Given a DHG $\mathcal{G}$ satisfying our assumptions, we construct an undirected approval graph $G=(N,E)$ on $\mathcal{G}$'s set of players $N$ as follows. For each agent $i$, an edge $\{i,j\}$ appears in $G$ iff both $i$ and $j$ approve the coalition $\{i,j\}$. %Let $N' \subseteq N$ be such that the graph $G' = (N',E \cap (N' \times N))$ is a connected component of $G$.
% If $G$ is connected, we subsequently prove a bijection between a welfare-optimal partition of $\mathcal{G}$ and an independent set of $G$. Indeed, given a welfare-optimal partition $\pi$, each agent. If $G$ is not connected, the above reasoning can be applied to each connected component of $G$.
% \end{proof}

% Given Theorem \ref{theorem:CCAUP-computationally-hard}, in the following theorem we infer that:
% \begin{theorem}
% \label{theorem:}

% \end{theorem}
% \begin{proof}

% %, and is deferred to Appendix \ref{supp:computational-hardness-popularity}.
% \end{proof}

\subsection{Approximate Probability of Welfare-Suboptimality}
\label{sec:Probability of Welfare-Suboptimality}
% By the reduction in Theorem \ref{theorem:max-intractable}, we can infer approximability results for \#CCAUP and CCAUP for welfare-optimal partitions among \textit{all} possible ones. For instance, from inapproximability results for MAX-IS, maximizing social welfare is not approximable within $n^{0.5-\varepsilon}$ for any $\varepsilon > 0$ unless NP=ZPP \cite{johan1999astad}. However, we can approximate the problem using approximation algorithms for WEIGHTED-SET-PACKING, where coalitions are weighted by the number of agents approving it. This gives a $\sqrt{n}$-approximation for $\poly(n)$-lists \cite{halldorsson2004approximations}.
%

% Next, we attend to welfare-optimal \textit{coalitions}. %Since exact computation of $Pr[\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)]$ is intractable for $k$-lists with $k \geq 2$, in this section we compute the probability of that $C$ is \textit{not} welfare-optimal w.r.t. $\mathcal{C}$ (i.e., $Pr[\overline{\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)}] = 1 - Pr[\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)]$) up to an approximation. Formally, a \textit{Fully Polynomial-time Randomized Approximation Scheme} (FPRAS)~\cite{karger1995randomized} for a for a probability function $p(x)$ is a randomized algorithm $A$ that, given as input a problem instance $x$, an error bound $\epsilon > 0$ and a reliability ratio $\delta > 0$, returns an $\epsilon$-approximation of $p(x)$ with probability $1-\delta$, in time polynomial in the size of $x$, $1/\epsilon$ and $\log (1/\delta)$. An FPRAS can be \textit{additive}, i.e., in $(p(x)-\epsilon, p(x)+\epsilon)$, or \textit{multiplicative}, i.e., in $((1-\epsilon)p(x), (1+\epsilon)p(x))$.
%
% \begin{remark}
% \label{remark:Approximations}
Similar to \cite{imber2021probabilistic}, an additive \textit{Fully Polynomial-time Randomized Approximation Scheme} (FPRAS) \cite{karger1995randomized} for $Pr[\overline{\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)}]$ can be obtained by a simple Monte Carlo estimation (by sampling and taking the ratio of the times in which $C$ is welfare-optimal), whenever we can test in polynomial time whether $C$ is welfare-optimal for a sample. Yet, a multiplicative FPRAS provides a stronger guarantee since it allows for approximating divisions of probabilities, which is required for estimating conditional probabilities. Thus, in Appendix I we depict the modifications of \cite{imber2021probabilistic}'s FPRAS for the probability of losing in an election so as to devise a FPRAS for the probability $Pr[\overline{\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)}]$.
% \end{remark}
% \begin{theorem}
% \label{theorem:FPRAS-not-welfare-optimal}
% There is a multiplicative FPRAS for estimating $Pr[\overline{\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)}] = 1 - Pr[\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)]$, the probability that $C$ is {\normalfont not} welfare-optimal w.r.t. a set $\mathcal{C}$ of poly-many coalitions.
% \end{theorem}
% \begin{proof}
% (\textit{Sketch})
% We adapt the Karp-Luby-Madras algorithm for approximating the number of satisfying assignments of a DNF formula~\cite{karp1989monte}. For $C \neq \tilde{C} \in \mathcal{C}$, let $\mathcal{M}_I(\tilde{C}, C)$ be the event that $\mathcal{SW}_I(\tilde{C}) > \mathcal{SW}_I(C)$. Thus, $\overline{\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)} = \vee_{C \neq \tilde{C} \in \mathcal{C}} \mathcal{M}_I(\tilde{C}, C)$. For the Karp-Luby-Madras algorithm, we need to perform the following tasks in poly-time: (1) Test whether $\mathcal{M}_I(\tilde{C}, C)$ is true for a given sample; (2) Compute $Pr[\mathcal{M}_I(\tilde{C}, C)]$ for every $C \neq \tilde{C} \in \mathcal{C}$; (3) Sample a random set $I$ of players from the posterior distribution conditioned on the event $\mathcal{M}_I(\tilde{C}, C)$. The first task is straightforward. For the other two tasks, in Appendix \ref{supp:Multiplicative FPRAS for the Probability of Unpopularity} we prove that the second one can be done in polynomial time (provided that $\mathcal{C}$ polynomially many coalitions), and supply an algorithm for sampling from the posterior distribution conditioned on $\mathcal{M}_I(\tilde{C}, C)$.
% \end{proof}


\begin{remark}
{\normalfont (\textbf{Disapproval $k$-Lists})} Similar to $k$-lists, agents could only {\normalfont disapprove} at most $k$ coalitions. Thus, we note that {\normalfont disapproval} $k$-lists also satisfy the above theorems.
\end{remark}

\subsection{Probability of Strict-Core-Stability}
\label{sec:Probability of Strict-Core-Stablity}
% Thus far, we have considered \textit{optimal} outcomes, whereas in this section we concern \textit{stable} ones. %In $2$-lists, it turns out that deciding zeroness of the probability that a partition is either perfect or Nash-stable is in FP.
% \begin{theorem}
% \label{theorem:perfect-2-lists-set}
% perfect-CCAUP, Nash-stable-CCAUP, deciding $Pr[\mathcal{PF}],Pr[\mathcal{NS}]>0$ -- are all in FP for $2$-lists.
% \end{theorem}
% \begin{proof}
% We prove for perfection, where the proof for Nash-stability follows from similar arguments, and is thus deferred to Appendix \ref{supp:Exact Probability of Nash-Stable}. Let $\mathcal{C}$, $\mathcal{M}$, $\mathcal{Q}$ be an instance of CSCPA under perfection. We reduce to 2SAT. Let $\mathcal{U} \subseteq \mathcal{M} \cup \mathcal{Q}$. Inspired by~\cite{peters2016complexity}, let $\mathcal{A}_i$ be the collection of all coalitions approved by agent $i$. We denote $\mathcal{X}_i = \{(\neg S \vee \neg T): S, T \in \mathcal{A}_i \text{ s.t. } S \cap T \neq \emptyset\}$ and $c_i = \wedge_{c \in \mathcal{X}_i} c$. We thus set $\mathcal{F}_\mathcal{U}^1 = (\wedge_{i \in \mathcal{U}} c_i)$. For each agent $i$, let $\mathcal{Y}_i = \{(A \vee B): i\text{ approves } A \text{ and } B\}$ and $d_i = \wedge_{c \in \mathcal{Y}_i } c $. Let $\mathcal{F}_\mathcal{U}^2 = (\wedge_{i \in \mathcal{U}} d_i)$. Let $\mathcal{F}_{\mathcal{U}} = \mathcal{F}_\mathcal{U}^1 \wedge \mathcal{F}_\mathcal{U}^2$. Then, given $\mathcal{Q}' \subseteq \mathcal{Q}$, any satisfying assignment of the 2SAT formula $\mathcal{F}_{\mathcal{M} \cup \mathcal{Q}'}$ can be translated to a perfect partition w.r.t. the set of players $\mathcal{M} \cup \mathcal{Q}'$, which enables deciding whether $Pr[\mathcal{PF}]>0$.
% \end{proof}
For strict-core-stability, we provide a \textit{negative} result.
\begin{theorem}
\label{theorem:strict-core-stable}
For strict-core-stability, \#$\exists$CCAUP is \#P-hard in $1$-lists. Further, $\exists$CCAUP and deciding $Pr[\mathcal{SCS}_{\mathcal{G}'}]>0$ are NP-complete for $1$-lists.
\end{theorem}
\begin{proof}
The proof is similar to that of Theorem \ref{theorem:max-intractable}, except that: (1) the reduction is from KERNEL \cite{szwarcfiter1994enumerating}, the problem of counting kernels of a digraph (an independent set reachable from every outside node by an edge); and (2) each arc agent $e = (u,v)$ approves $A_u$. Due to space constraints, we omit the details.
\end{proof}


% \begin{remark}
% \label{remark:envy-free}
% {\normalfont (Envy-Freeness)} A similar construction can be employed for envy-freeness. Particularly, we note that a perfect partition is envy-free, since no agent can improve.
% \end{remark}


\section{Anonymous Hedonic Games}
\label{sec:Anonymous Hedonic Games}
In an \textit{anonymous} hedonic game (AHG)~\cite{ballester2004np}, agents’ preferences $\succeq_i$ are determined by an underlying ordering $\unrhd_i$ over the possible coalition sizes $[n]$, with $S \succeq_i T$ iff $|S| \unrhd_i |T|$. The following theorem analyzes the complexity of \#$\exists$CCAUP and $\exists$CCAUP for Nash-stable, strict-core-stable and perfect partitions, as well as the verifying the zeroness of $Pr[\mathcal{NS}_{\mathcal{G}'}]$, $Pr[\mathcal{SCS}_{\mathcal{G}'}]$ and $Pr[\mathcal{PF}_{\mathcal{G}'}]$.
\begin{theorem}
\label{theorem:Nash-stable-anonymous}
For Nash-stability, strict-core-stability and perfection, \#$\exists$CCAUP is \#P-hard in AHGs. Further, $\exists$CCAUP, deciding $Pr[\mathcal{NS}_{\mathcal{G}'}], Pr[\mathcal{SCS}_{\mathcal{G}'}], Pr[\mathcal{PF}_{\mathcal{G}'}] > 0$, are all NP-complete in AHGs.
\end{theorem}
\begin{proof}
(\textit{Sketch})
In Appendix J, we show a reduction from X3C to NS-$\exists$CCAUP that adapts the reduction from X3C presented in Theorem 9 of~\cite{peters2016complexity}. %Given elements $X = \{x_1, \dots, x_{3n}\}$ and sets $S = \{s_1, \dots, s_m\}$, assign the \textit{code number} $12k$ to the set $s_k$. Introduce a set of $3n$ participating players, one for each element in $X$, and a single stalker agent. Let $\mathcal{M}$ be the of all participating players and the stalker player. For each set $s_k$, introduce $12k-3$ non-participating players, and denote by $\mathcal{Q}$ the set of all such players. The element player of $x_i$ approves coalitions of size $1$ and the code numbers of the sets that include $x_i$. The non-participating players of $s_k$ approve the sizes $1$, $3$ and $12k$. The stalker agent approves size $2$. Finally, let $\mathcal{C}$ be the set of all possible partitions. In Appendix \ref{supp:CCAUP for Anonymous Hedonic Games}, we prove that each exact set cover corresponds one-to-one to a subset of players $\mathcal{Q}' \subseteq \mathcal{Q}$ and a partition $\pi$ s.t. $\pi$ is Nash-stable w.r.t. the set of players $\mathcal{M} \cup \mathcal{Q}'$, thus providing us with a poly-time reduction. Intuitively, the key component which guarantees this bijection is the \textit{code number}, which uniquely identifies each set. We thus conclude that \#$\exists$CCAUP and \#$\exists$CCAUP-All are \#P-hard for AHGs.
By Lemma \ref{lemma:connection partitions}, deciding $Pr[\mathcal{NS}_{\mathcal{G}'}] > 0$ is \#P-hard. The proof for perfect-$\exists$CCAUP similarly adapts the reduction presented in Theorem 18 of \cite{woeginger2013core}, and is thus differed to Appendix J along with the proof for deciding $Pr[\mathcal{PF}_{\mathcal{G}'}]>0$. The same reduction can be used for SCS.
\end{proof}

Boehmer and Elkind \shortcite{boehmer2020individual} show that finding a Nash-stable partition can be done in poly-time if each agent approves at most one coalition size. Despite the negative result in Theorem \ref{theorem:Nash-stable-anonymous}, we prove that such a condition further enables us to compute both $Pr[\mathcal{NS}_{\mathcal{G}'}(\pi)]$ and $Pr[\mathcal{PF}_{\mathcal{G}'}(\pi)]$ in polynomial-time for AHGs.
\begin{theorem}
\label{theorem:nash-at most one coalition size}
If each agent $i \in N$ solely approves coalitions in $\mathcal{N}_i^+ = \{C \in \mathcal{N}_i : |C| = s_i\}$ for some $s_i \in \mathbb{N}$, then $Pr[\mathcal{NS}_{\mathcal{G}'}(\pi)]$ and $Pr[\mathcal{PF}_{\mathcal{G}'}(\pi)]$ are poly-time computable.
\end{theorem}

\begin{proof}
(\textit{Sketch}) Note that $Pr[\mathcal{PF}_{\mathcal{G}'}(\pi)] = Pr[\cap_{i \in N} |\pi(i) \cap I| = s_i]$. %= \prod_{i \in N} \sum_{j \in [n]} Pr[|\pi(i) \cap I| = s_i \wedge |I| = j]
If $|\pi(i)| < s_i$ for some $i \in N$, then $Pr[\mathcal{PF}_{\mathcal{G}'}(\pi)] = 0$. Thus, we hereafter assume that $|\pi(i)| \geq s_i$. Let $\mathds{1}_i$ be the indicator for the event that agent $i$ participates in the game. For integers $t \leq n$ and $0 \leq q_i \leq n$ ($i \in [n]$), let $\mathcal{L}(t,\{q_i\}_{i \in [n]}) = Pr[\cap_{i \in N} \sum_{j \in \pi(i) \cap I \cap [t]} \mathds{1}_j = q_i]$. In Appendix K, we show that it can be computed in poly-time via the dynamic program in Algorithm \ref{alg:perfect}, and so does the probability that $\pi$ is perfect.  %Note that $\mathcal{L}(0,\{0\}_{i \in [n]}) = 0$ and $\mathcal{L}(0,\{q_i\}_{i \in [n]}) = 1$ for $q_i \neq 0$ for each $i \in [n]$. Let $t \geq 1$ and $i \in [n]$. If $t \notin \pi(i)$, then agent $t$ does not affect the cardinality of $\pi(i) \cap I \cap [t]$. If $t \in \pi(i)$, we consider two cases: the event $\sum_{j \in \pi(i) \cap I \cap [t]} \mathds{1}_j = q_i$ is equivalent to $\sum_{j \in \pi(i) \cap I \cap [t-1]} \mathds{1}_j = q_i-1$ if $\mathds{1}_t = 1$, and $\sum_{j \in \pi(i) \cap I \cap [t-1]} \mathds{1}_j = q_i$ otherwise. Since $t \in \pi(i)$ yields $\pi(t) = \pi(i)$, we conclude that: $\mathcal{L}(t,\{q_i\}_{i \in [n]}) = p_t \mathcal{L}(t-1,\{q_i-1\}_{i \in \pi(t)} \cup \{q_j\}_{j \in [n] \setminus \pi(t)}) + (1-p_t) \mathcal{L}(t-1,\{q_i\}_{i \in [n]})$. Noting that $\mathcal{L}(n,s_i) = Pr[|\pi(i) \cap I| = s_i]$, it can be computed in poly-time via dynamic programming, and so does the probability that $\pi$ is perfect ($Pr[\mathcal{PF}_{\mathcal{G}'}(\pi)]$).
For computing $Pr[\mathcal{NS}_{\mathcal{G}'}(\pi)]$, if there is no agent $i$ with $s_i = 1$, then the grand coalition is NS. Thus, we hereafter assume that there exists at least one such agent. For each $j \in [n]$, let $N_j = \{i \in N : s_i = j\}$, and let $\ell = \max\{i | N_j = \emptyset \forall j \in [i]\}$. Boehmer and Elkind \shortcite{boehmer2020individual} prove that for each $j \in [\ell]$ all agents in $N_j$ need to be in coalitions of size $j$ in every NS outcome. Noting that $Pr[\mathcal{NS}_{\mathcal{G}'}(\pi)] = Pr[\cap_{j \in [\ell]} \cap_{i \in N_j} |\pi(i) \cap I| = j]$, the proof thus follows from arguments similar to the previous one.
%Note that: $Pr[|\pi(i) \cap I| = s_i] = \sum_{U \subseteq [n]} Pr[|\pi(i) \cap I| = s_i| I = U] Pr[I=U]$. Let $\mathcal{L}_i(U) := Pr[|\pi(i) \cap I| = s_i| I = U]$. We consider two cases: if $|\pi(i)| = s_i$, then $\mathcal{L}_i(U) = 1$ $(0)$ if and only if $\pi(i) \cap I = \emptyset$ ($\pi(i) \cap I \neq \emptyset$). Thus, $\mathcal{L}_i(U) = 1$ only for $U \subseteq N \setminus \pi(i)$. We infer that $Pr[|\pi(i) \cap I| = s_i] = $
\end{proof}

\begin{algorithm}[tb]
\caption{Computing $Pr[\mathcal{PF}_{\mathcal{G}'}(\pi)]$}
\label{alg:perfect}
\begin{algorithmic}[1] %[1] enables line numbers
\STATE $\mathcal{L}(0,\{0\}_{i \in [n]}) = 0$, $\mathcal{L}(0,\{q_i\}) = 1$ ($q_i \neq 0$ $\forall i \in [n]$)
\FOR{$t=0$ to $n$}
\IF {$\exists i \in [n]$ s.t. $\pi(t) = \pi(i)$}
\STATE $\mathcal{L}(t,\{q_i\}_{i \in [n]}) = p_t \mathcal{L}(t-1,\{q_i-1\}_{i \in \pi(t)} \cup \{q_j\}_{j \in [n] \setminus \pi(t)}) + (1-p_t) \mathcal{L}(t-1,\{q_i\}_{i \in [n]})$
\ELSE
\STATE $\mathcal{L}(t,\{q_i\}_{i \in [n]}) = \mathcal{L}(t-1,\{q_i\}_{i \in [n]})$
\ENDIF
\ENDFOR
\STATE \textbf{return} $Pr[\mathcal{PF}_{\mathcal{G}'}(\pi)] = \mathcal{L}(n,\{s_i\}_{i\in[n]})$
\end{algorithmic}
\end{algorithm}

\section{Candidate Intervals}
\label{sec:Candidate Intervals}
Assuming the agent set can be placed in the natural ordering, each agent $i$ only approves \textit{candidate intervals} (CIs) $[a, b]$ of agents (with $i \in [a, b]$). Such a restriction was termed by Elkind and Lackner \shortcite{elkind2015structure}, and applied to DHGs by~\cite{peters2016complexity}. %Note that since there are only $O(n^2)$ possible approved coalitions ($\binom{n}{2}$ interval endpoints), .
Opposed to the negative result for $k$-lists with $k \geq 2$ (Theorems \ref{theorem:CCAUP-computationally-hard} and \ref{theorem:max-intractable}), we prove that:
\begin{theorem}
\label{theorem:CI-max-sw}
$Pr[\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)]$, $Pr[\mathcal{WO}_{\mathcal{G}'}^{\Pi}(\pi)]$ and $Pr[\mathcal{PF}_{\mathcal{G}'}(\pi)]$ are computable in poly-time for CIs.
\end{theorem}
\begin{proof}
For an integer $0 \leq j \leq n$, let $\mathcal{SW}^\star(j)$ and $\mathcal{SW}_I(j)$ be the maximum social welfare and the maximum coalitional social welfare over all coalitions (resp.) obtainable in the subgame restricted to the random agent set $I \cap [j]$. Each agent approves all originally approved coalitions $S$ such that $S \subseteq I \cap [j] \cup \{0\}$. Note that $\mathcal{SW}^\star(0) = 0$. Let $\#[t,j]$ be the number of agents that approve the interval $[t, j]$ in the subgame. Similar to Theorem 10 in~\cite{peters2016complexity}, we infer that $\mathcal{SW}^\star(j) = \max_{t \in [j]} \{\mathcal{SW}^\star(j-1) + \#[t,j]\}$, which can thus be computed in polynomial time via dynamic programming. Noting that $Pr[\mathcal{WO}_{\mathcal{G}'}^{\Pi}(\pi)] = Pr[\mathcal{SW}_I(\pi) = \mathcal{SW}^\star(n)]$ and that $Pr[\mathcal{SW}_I(\pi) = q]$ can be computed via dynamic programming (by arguments similar to the proof of Theorem \ref{theorem:max-tractable}, which are thus deferred to Appendix L), we infer that $Pr[\mathcal{WO}_{\mathcal{G}'}^{\Pi}(\pi)]$ is in FP for CIs. By substituting $\mathcal{SW}^\star(j)$ with $\mathcal{SW}_I(j)$, we obtain that $Pr[\mathcal{WO}^{\mathcal{C}}_{\mathcal{G}'}(C)]$ is also in FP for CIs. Since a partition $\pi$ is perfect iff $\mathcal{SW}^\star(\pi) = n$, the proof for $Pr[\mathcal{PF}_{\mathcal{G}'}(\pi)]$ readily follows.
\end{proof}
%Denoting $I = \{i_\ell\}_{\ell=1}^{|I|}$, for $q \in [n] \cup \{0\}$ we have: $Pr[\mathcal{SW}_I(\pi) = q] = \sum_{j=q-1}^{q} Pr[\mathcal{SW}_I(\pi) = q \cap \sum_{i=2}^n \mu_i(\pi) = j] = \sum_{j=q-1}^{q} Pr[\mu_{i_1}(\pi) = q - j] Pr[\sum_{\ell=2}^{|I|} \mu_{i_\ell}(\pi) = j]$, where the last equality is due to players' independence and dichotomous preferences.


% \section{Analysis of Expected Outcomes}
% \label{sec:Analysis of Expected Outcomes}
% Thus far, we analyzed the \textit{\textbf{probability}} that outcomes (either coalitions or partitions) are optimal in terms of either popularity or social welfare. In contrast, in this section we investigate the performance of outcomes in \textit{\textbf{expectation}}. First, in \textit{majority games} with either independent random players or random graphs, we extensively characterize the distribution of coalitions comprising a \textit{perfect} partition $\pi$ (i.e., \textit{every} agent is in an approved coalition in $\pi$), as well as the social welfare incurred by them (Subsection \ref{sec:Perfect Partitions in Majority Games}).

\section{Roommate Games}
\label{sec:Roommates}
In this section, we consider a restriction of hedonic games where agents only approve coalitions of size at most $2$ \cite{gardenfors1975match}. The bipartite case of roommate games (RGs) is referred to as \textit{marriage} games \cite{gale1962college}. See \cite{gusfield1989stable} for a survey on both types of games. %Though finding perfect partitions is easy by Theorem 7 in \cite{aziz2013pareto}, it appears that: %perfect-\#CCAUP-$m$ (Problem \ref{problem:bounded}) is \#W[1]-hard in the parameter $m$ for roommates.
% \begin{theorem}
% \label{theorem:roommates-perfect}
% Perfect-\#$\exists$CCAUP-$m$ (Problem \ref{problem:bounded}) is \#P-hard and \#W[1]-hard in the parameter $m$ for roommates.
% \end{theorem}
% \begin{proof}
% The proof is by reduction from \#MATCH, the problem of counting all matchings of size $m$ in a graph, which is known to be \#W[1]-hard in the parameter $m$ \cite{curticapean2013counting} and \#P-hard \cite{valiant1979complexity}. Given an undirected graph $G=(V,E)$ with $|V|=n$, we choose $\mathcal{M}=\emptyset, \mathcal{Q}=V$. For each edge $\{i,j\} \in E$, agent $i$ solely approves the coalition $\{i,j\}$. We claim that each $\mathcal{Q}' \subseteq \mathcal{Q}$ with $|\mathcal{Q}'| \leq 2m$ s.t. there exists a perfect partition $\pi$ w.r.t. $\mathcal{M} \cup \mathcal{Q}'$ corresponds one-to-one to a matching of size $\leq m$ in $G$. Indeed, in such a perfect partition $\pi$, each player $i \in \mathcal{Q}'$ is matched to a player $j \neq i$. Since $\{i,j\} \in E$ by our construction, we are provided with a matching of size $\leq m$. Similarly, given a matching $E'$ of size $\leq m$, let $\mathcal{Q}' \subseteq \mathcal{Q}$ be all players that are matched under $E'$ ($|\mathcal{Q}'| \leq 2m$). The edges in $E'$ comprise a perfect partition w.r.t. $\mathcal{M} \cup \mathcal{Q}'$.
% \end{proof}
% \begin{lemma}
% \label{lemma:reduces}
% Perfect-\#$\exists$CCAUP-$m$ (Problem \ref{problem:bounded}) is \#W[1]-hard in the parameter $m$ for roommates.
% \end{lemma}
% \begin{proof}
% Given a $\beta$-\#$\exists$CCUDP-$m$ instance $(\mathcal{C}, \mathcal{M}, \beta, m)$, we construct a $\beta$-\#$\exists$CCAUP-$m$ instance $(\mathcal{C}, \emptyset, \mathcal{M}, \beta, m)$ with no participating players and a set $\mathcal{M}$ of non-participating ones. The number of solutions for both are equivalent.
% \end{proof}
Finding perfect partitions is easy by Theorem 7 in \cite{aziz2013pareto}. Moreover, a core stable matching can be computed efficiently for marriage games \cite{gale1962college}. However, we obtain negative results for both concepts in \textit{non-dichotomous} marriage games and other classes of hedonic games.
\begin{theorem}
\label{theorem:nash-stable-marriage}
In marriage games, Perfect/Nash-stable-$\exists$CCAUP(-$m$) and deciding $Pr[\mathcal{NS}_{\mathcal{G}'}], Pr[\mathcal{PF}_{\mathcal{G}'}] > 0$ are NPC. The same applies to {\normalfont roommates}, {\normalfont Representation by Individually Rational Lists of Coalitions (RIRLC)} \cite{ballester2004np}, {\normalfont additively separable hedonic games} \cite{olsen2009nash}, {\normalfont B-hedonic games} and {\normalfont W-hedonic games} (Aziz et al. \shortcite{aziz2012individual}).
\end{theorem}
\begin{proof}
(\textit{Sketch}) In Appendix M, we show a reduction from MinMaxMatch, the problem of finding a maximal matching with size $\leq m$, which is known to be NP-complete even for subdivision graphs \cite{horton1993minimum}. The proof constitutes an adaptation of Theorem 1 in \cite{aziz2013stable}. The same reduction can be used for perfection. %can be adapted, we reduce from MinMaxMatch, the problem of finding a maximal matching with size $\leq m$, which is known to be NP-complete even for subdivision graphs \cite{horton1993minimum}. A graph $G=(V,E)$ is the subdivision graph of $G'=(V',E')$ if $V = V' \cup E'$ and $\{e,v\} \in E$ if and only if $e \in E'$, $v \in V'$ and $v$ is incident to $e$ in $G'$. Thus, $G$ is a bipartite graph with $V = A \cup B$. As in \cite{aziz2013stable}, we assume that $|A|=|B|=n$. We construct an instance of CCAUP by choosing $\mathcal{M} = \emptyset$ and $\mathcal{Q} = V$. Each player $v \in V$ approves all coalitions $\{v,u\} \in E$. In Appendix ??, we show a bijection between each maximal matching of size $\leq m$ and each $\mathcal{Q}' \subseteq \mathcal{Q}$ of size s.t. there exists a Nash-stable partition w.r.t. $\mathcal{M} \cup \mathcal{Q}'$.
By Corollary 1 in \cite{aziz2013stable}, we further deduce the result for the other classes of hedonic games.
\end{proof}

\section{Perfect Partitions in Majority Games}
\label{sec:Perfect Partitions in Majority Games}
Thus far, we analyzed the \textit{\textbf{probability}} that either coalitions or partitions satisfy a solution concept. In contrast, we herein explore their \textit{\textbf{average}} performance in \textit{majority games} \cite{peters2016complexity}. This class can be seen as a dichotomization of \textit{fractional hedonic games}~\cite{aziz2019fractional}. Formally, let $G = (N, E)$ be an undirected graph, where each agent corresponds to a vertex and an edge between two agents depicts a (mutual) friendship between them. Let $G_I = (I, E^I)$ be the random subgraph of $G$ induced by $I$. Letting $d_i^I(C)$ be agent $i$'s degree in the subgraph of $G_I$ induced by a coalition $C$, agent $i$ approves $C$ if $d_i^I(C) \geq \frac{|C|}{2}$, i.e., if $i$ is connected to at least $\frac{|C|}{2}$ of the vertices in $C$. First, we characterize the distribution of both the coalitions and social welfare of \textit{perfect} partitions (Theorems \ref{theorem:perfect}-\ref{theorem:perfect-random-graph}), on which we elaborate in Appendices N--O. Then, we discuss the performance of perfect outcomes by providing upper and lower bounds on their \textit{Price of Anarchy}~\cite{koutsoupias1999worst}.

% \subsection{The Distribution of Perfect Partitions}
% \label{sec:The Distribution of Perfect Partitions}
By Theorem 14 in~\cite{peters2016complexity}, without loss of generality, a perfect partition consists of edges and triangles. Thus, we let $M_n^I$ and $T_n^I$ be the random variables which represent the number of edges and triangles in $G_I$ (resp.). Let $\mathbb{T}$ be the set of all triplets $(i,j,k)$ ($i<j<k$) that form a triangle in $G$. Accordingly, the following theorem fully characterizes the social welfare of a \textit{perfect} partition $\pi$, as well as the coalitions comprising $\pi$, for various values of $(p_i)_{i \in N}$.
\begin{theorem}
\label{theorem:perfect}
For each $i \in N$ and $n \in \mathbb{N}$, let $p_i(n) = \frac{q_i(n)}{n}$ for some $q_i : \mathbb{N} \rightarrow \mathbb{R}$, $q^{\max}(n) = \max_{i \in N} q_i(n)$ and $q^{\min}(n) = \min_{i \in N} q_i(n)$. Given a perfect partition $\pi$, we infer: {\normalfont {\textbf{(1)} A perfect partition comprises of singletons w.h.p. (with high probability):}} If $q^{\max}(n) \rightarrow 0$ as $n \rightarrow \infty$, then $T_n^I = 0$, $M_n^I = 0$ and $\mathcal{SW}_I(\pi) = 0$; {\normalfont {\textbf{(2)} Triangles and edges reside in perfect partitions a.s. (almost surely):}} If $|\mathbb{T}| = 1$ and $\frac{n}{q^{\min}(n)} \rightarrow 1$ as $n \rightarrow \infty$, then $T_n^I \geq 1$ a.s. Otherwise, if $|\mathbb{T}| \geq 2$ and $q^{\min}(n) \rightarrow \infty$ as $n \rightarrow \infty$, then $T_n^I \geq 1$ and $M_n^I \geq 1$ a.s.; {\normalfont \textbf{(3)}} If $\frac{q^{\max}(n)}{q^{\min}(n)} \rightarrow 1$ as $n \rightarrow \infty$, then $\frac{q^{\min}(n)}{n} \leq \mathbb{E}[|I|] \leq q^{\max}(n)$, thus yielding that $|I| \geq 1$ (i.e., {\normalfont {at least one agent remains}}) a.s.; {\normalfont \textbf{(4)}} If $q_i(n) \equiv c_i$ for $c_i > 0$ $\forall i$, then $\mathbb{E}[\mathcal{SW}_I(\pi)] \leq c_{\max}^2$, where $q^{\max}(n) \equiv c_{\max}$.
% \begin{enumerate}
%     \item A perfect partition comprises of singletons w.h.p. (with high probability): If $q^{\max}(n) \rightarrow 0$ as $n \rightarrow \infty$, then $T_n^I = 0$, $M_n^I = 0$ and $\mathcal{SW}_I(\pi) = 0$.
%     \item Triangles and edges reside in perfect partitions a.s. (almost surely): If $|\mathbb{T}| = 1$ and $\frac{n}{q^{\min}(n)} \rightarrow 1$ as $n \rightarrow \infty$, then $T_n^I \geq 1$ a.s. (almost surely). Otherwise, if $|\mathbb{T}| \geq 2$ and $q^{\min}(n) \rightarrow \infty$ as $n \rightarrow \infty$, then $T_n^I \geq 1$ and $M_n^I \geq 1$ a.s.
%     \item One agent remains a.s.: If $\frac{q^{\max}(n)}{q^{\min}(n)} \rightarrow 1$ as $n \rightarrow \infty$, then $\frac{q^{\min}(n)}{n} \leq \mathbb{E}[|I|] \leq q^{\max}(n)$, thus yielding that $|I| \geq 1$ a.s.
%     \item If $q_i(n) \equiv c_i$ for $c_i > 0$ ($\forall i \in N$), then $\mathbb{E}[\mathcal{SW}_I(\pi)] \leq c_{\max}^2$, where $q^{\max}(n) \equiv c_{\max}$.
% \end{enumerate}
\end{theorem}

Further, we can model agents' \textit{uncertainty about their mutual friendships}. Formally, let $(p_{ij})_{i, j \in N} \in [0,1]^{n \times n}$ with $p_{ij} = p_{ji}$ for every $i, j \in N$. Let $\mathcal{E} \subseteq N \times N$ be a random variable, where $(i,j) \in \mathcal{E}$ with probability $p_{ij}$ and different pairs of indices are independent, thus yielding a \textit{Erd\"{o}s-R\'{e}nyi random graph} $\tilde{G}=(N,\mathcal{E})$~\cite{erdos59random} whose set of edges is $\mathcal{E}$. The majority game on the resulting random graph satisfies 1-3 in Theorem \ref{theorem:perfect} with minor adjustments (See Appendix O.1), yet gives rise to an additional property which extends property 4 (proved in Appendix O.2):%, as formulated in the following theorem.
\begin{theorem}
\label{theorem:perfect-random-graph}
Let $p_{ij}(n) = c/n$ for some constant $c > 0$. Let $\pi$ be a perfect partition. Then, $T_n^I$ converges in distribution to a Poisson random variable with parameter $c^3/6$, $\mathbb{E}[M_n^I] = (n-1) c/2$ and $\mathbb{E}[\mathcal{SW}(\pi)] \leq (n-1) c$.
\end{theorem}

% \subsection{(Expected) Price of Perfection}
% \label{sec:(Expected) Price of Perfection}
Let $\mathbb{P}_I$ be the set of all perfect partitions for a random set of players $I$ and let $\pi^\star$ be an welfare-optimal partition. Inspired by the \textit{Price of Anarchy}~\cite{koutsoupias1999worst}, we put forth the \textit{Price of Perfection} (\textbf{PP}) of a RDHG $\mathcal{G}'$, defined as the worst-case ratio between the social welfare of $\pi^\star$ and that of a perfect partition, i.e., $\text{PP}(\mathcal{G}') = \max_{\pi \in \mathbb{P}_I} \frac{\mathcal{SW}_I(\pi^\star)}{\mathcal{SW}_I(\pi)}$. Similarly, we define the \textit{Expected Price of Perfection} (\textbf{EPP}) by $\text{EPP}(\mathcal{G}') = \max_{\pi \in \mathbb{P}_I} \frac{\mathbb{E}[\mathcal{SW}_I(\pi^\star)]}{\mathbb{E}[\mathcal{SW}_I(\pi)]}$. Using Theorem \ref{theorem:perfect}, we devise upper and lower bounds on both variants of the price of perfection, where Corollary \ref{corollary:almost-sure-lower-bound} is clearly a direct outcome of (3)-(4) in Theorem \ref{theorem:perfect}.
\begin{lemma}
\label{lemma:almost-sure-upper-bound}
Under the assumptions of Theorem \ref{theorem:perfect} and: (1) in Theorem \ref{theorem:perfect}, $\text{PP}(\mathcal{G}') = \text{EPP}(\mathcal{G}') = 0$ w.h.p.; (2) in Theorem \ref{theorem:perfect}, $\text{PP}(\mathcal{G}') \leq |I|/2$ a.s.; (3)-(4) in Theorem \ref{theorem:perfect}, $\text{EPP}(\mathcal{G}') \leq q^{\max}(n) = c_{\max}/2$.
% \begin{enumerate}
%     \item (1) in Theorem \ref{theorem:perfect}, $\text{PP}(\mathcal{G}') = \text{EPP}(\mathcal{G}') = 0$ w.h.p.
%     \item (2) in Theorem \ref{theorem:perfect}, $\text{PP}(\mathcal{G}') \leq |I|/2$ a.s.
%     \item (3)-(4) in Theorem \ref{theorem:perfect}, $\text{EPP}(\mathcal{G}') \leq q^{\max}(n) = c_{\max}/2$.
% \end{enumerate}
\end{lemma}
\begin{proof}
For (1), the claim clearly stems since $M_n^I = 0$ w.h.p. For (2), $\pi^\star$ clearly satisfies $\mathcal{SW}_I(\pi^\star) \leq |I|$. If we were to consider each connected component of $G$ separately, we may assume that $G$ is connected and does not consists of any isolated vertices. Hence, if there exists a perfect partition in $G$, then a perfect partition consisting of edges and triangles exists (Theorem 14 in~\cite{peters2016complexity}). However, $G_I$ might contain isolated vertices, even if $G$ does not. Since $M_n^I \geq 1$ a.s., we infer that $\mathcal{SW}_I(\pi) \geq 2$ at the very least, thus yielding that $\text{PP}(\mathcal{G}') \leq |I|/2$. For (3), we observe that $\mathbb{E}[\mathcal{SW}_I(\pi^\star)] \leq \mathbb{E}[|I|] \leq q^{\max}(n)$. Combined with the proof for (2), we conclude that $\text{EPP}(\mathcal{G}') \leq q^{\max}(n)$.
\end{proof}
\begin{corollary}
\label{corollary:almost-sure-lower-bound}
Under the assumptions of (3)-(4) in Theorem \ref{theorem:perfect}, if $\mathcal{SW}(\pi^\star) \geq 1$, then $\text{EPP}(\mathcal{G}') \geq 1 / c_{\max}^2$. Alternately, if $\mathcal{SW}_I(\pi^\star) = |I|$, we infer that $\text{EPP}(\mathcal{G}') \geq \frac{c_{\min}}{n c_{\max}^2}$.
\end{corollary}
\begin{proof}
The first lower bound is a direct outcome of (4) in Theorem \ref{theorem:perfect}. For the second part, from (3) in Theorem \ref{theorem:perfect} we infer that $\frac{q^{\min}(n)}{n} \leq \mathbb{E}[\mathcal{SW}_I(\pi^\star)] \leq q^{\max}(n)$. Combined with (4) in Theorem \ref{theorem:perfect}, we conclude the desired bounds.
\end{proof}


% \subsection{Expected Optimal Outcomes}
% \label{sec:Expected Optimal Outcomes}
% Given a RDHG $\mathcal{G}'$, a coalition $C \subseteq N$ is popularity- and welfare-optimal w.r.t. a partition $\pi$ of $N$ \textit{\textbf{in expectation}} iff $C \in \argmax_{\tilde{C} \subseteq N} \mathbb{E}[\phi_I(\tilde{C})]$ and $C \in \argmax_{\tilde{C} \in \pi} \mathbb{E}[\mathcal{SW}_I(\tilde{C})]$ (resp.).



\section{Conclusions and Future Work}
\label{sec:Conclusions and Future Work}

% In majority games, we have extensively characterized the distribution of coalitions comprising perfect partitions in majority games with either independent random players or random graphs, as well as the social welfare incurred by them.
Our work contributes significantly to the study of hedonic games, as the first one to explore the complexity of probabilistically inferring solution concepts in uncertain domains. The main complexity results are summarized in Table \ref{tab:complexity results on probabilistic inference}. Our study opens the way for many future works, including the investigation of other classes of hedonic games and other solution concepts. Further, our probabilistic setting arises several intriguing questions, among those: For an outcome satisfying a solution concept $\beta$, what is the maximum number of players whose withdrawal from the game still preserves $\beta$ in the outcome induced by the remaining players? Another direction is \textit{robustness} \cite{igarashi2019robustness}: A probabilistic withdrawal of players upon an outcome satisfying a solution concept $\beta$ (e.g., stability) should preserve $\beta$. %Due space constraints, our summary of the main complexity results on probabilistic inference is deferred to Table \ref{tab:complexity results on probabilistic inference} in Appendix \ref{supp:Overview of our Computational Complexity Results}.
%Specifically, we found cases that admit efficient algorithms for some of these problems, yet they become \#P-hard in their complementary scenarios. Thus, we showed when deciding that the probability of optimality is nonzero can be done in poly-time, and devised a multiplicative FPRAS for the probability of unoptimality. Surprisingly, it appears that despite that maximizing social welfare is NP-complete even when agents approve at most one coalition~\cite{peters2016complexity}, computing the probability of partitions' optimality can be done in polynomial time in this case. Further, we prove that computing the probability that a partition satisfies either Nash-stability or that \textit{every} agent is in an approved coalition is \#P-hard, even though that finding such partitions is easy when agents approve at most $2$ coalitions~\cite{peters2016complexity}. Since DHGs are one of the very few sub-classes of hedonic games that admit polynomial time solutions, these results put this property of DHGs in question when it comes to a probabilistic setting. For majority games, we fully covered the distribution of coalitions comprising perfect partitions. In Thm.\ref{theorem:perfect} (1), a perfect partition comprises of singletons, whereas other cases allow for triangles and edges to reside in perfect partitions (w.h.p.). We also devised the \textit{Price of Perfection}, along with upper and lower bounds.

% For DHGs with $k$-lists, we focused on the complexity of evaluating the probability that a certain coalition is either popularity- or welfare-optimal. We proved that both are computable in poly-time for $1$-lists, yet are \#P-hard for $k$-lists with $k \geq 2$. However, we observed that their zeroness can be verified in poly-time.

% It is worthy of noting that such a restriction yields that even if a partition $\pi$ is not Nash-stable in the original DHG, it might become Nash-stable in its corresponding RDHG, and vice versa.

%If \textit{every} agent is in an approved coalition in $\pi$, then $\pi$ is called \textit{perfect}. Fairness can be formalised as follows: a partition $\pi$ is \textit{envy-free} if there is no agent $i$ who would prefer to be in the position of agent $j$, i.e., $\pi(j) \setminus \{j\}\cup\{i\} \succ_i \pi(i)$.

%the coalitions $\mathcal{N}_i$ can be partitioned into \textit{approved} coalitions $\mathcal{N}_i^+$ and \textit{non-approved} coalitions $\mathcal{N}_i^-$ such that $i$ strictly prefers approved coalitions to non-approved ones, but is indifferent within the two groups: so $S \succ_i T$ iff $S \in \mathcal{N}_i^+$ and $T \in \mathcal{N}_i^-$.
%
\newpage
\section*{Acknowledgements}
This research was funded in part by ISF grant 1563/22.

We consider a multi-level jury problem in which ex
\clearpage
\bibliography{aaai23}

\end{document}