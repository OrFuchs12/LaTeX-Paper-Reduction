\section{ID Homomorphisms} \label{sec:CID-homomorphisms-main}


To make the analysis easier, we will often want to transform an original ID graph into a more structured one.
Before describing the structure we will be aiming for, we consider the general question of when a modified ID graph retains important properties of the original.
To this end, we will define  the concept of an \emph{ID homomorphism}, 
which we then use to define a class of property-preserving ID transformations. (Proofs are supplied in \cref{sec:CID-homomorphisms}.)%


\input{definitions/cid-homomorphism}





\begin{figure}
    \centering
    \begin{influence-diagram}
    \setcompactsize
    
    \node (Y1) {$Y$};
    \node (D1) [decision, right = of Y1] {$D$};
    \node (U1) [utility, below = of D1] {$U$};
    \edge{Y1}{D1};
    \edge{D1}{U1};
    \node (G1) [fit={(Y1) (D1) (U1)}, inner sep=2mm] {};
    \node [rectangle, draw=none, below = 0.1 of G1] {$\calG$\\ original};
    
    \node (D2) [decision, right = 1 of D1] {$D$};
    \node (U2) [utility, below = of D2] {$U$};
    \edge{D2}{U2};
    \node (G2) [fit={(D2) (U2)}, inner sep=2mm]
    {};
    \node [rectangle, draw=none, below = 0.1 of G2] {$\calG'$\\ remove $Y$};
    
    \node (D3) [decision, right = 1 of D2] {$D$};
    \node (D3p) [decision, right = of D3] {$D'$};
    \node (U3) [utility, below = of D3] {$U$};
    \edge{D3,D3p}{U3};
    \edge{D3}{D3p}
    \node (G3) [fit={(D3) (D3p) (U3)}, inner sep=2mm]
    {};
    \node [rectangle, draw=none, below = 0.1 of G3] {$\calG''$\\ duplicate $D$};
    
    \node (D4) [decision, right = 1 of D3p] {$D$};
    \node (D4p) [decision, right = of D4] {$D'$};
    \node (U4) [utility, below = of D4] {$U$};
    \edge{D4}{U4};
    \edge{D4}{D4p}
    \node (G4) [fit={(D4) (D4p) (U4)}, inner sep=2mm]
    {};
    \node [rectangle, draw=none, below = 0.1 of G4] {$\calG'''$\\ remove an edge};
    
    \path (D2) edge[->, bend right, blue, thick] (D1);
    \path (U2) edge[->, bend right, blue, thick] (U1);
    
    \path (D3) edge[->, bend right, green, thick] (D2);
    \path (D3p) edge[->, bend left, green, thick] (D2);
    \path (U3) edge[->, bend left, green, thick] (U2);
    
    \path (D4) edge[->, bend right, orange, thick] (D3);
    \path (D4p) edge[->, bend left, orange, thick] (D3p);
    \path (U4) edge[->, bend left, orange, thick] (U3);
    
    \end{influence-diagram}
    \caption{A sequence of homorphic transformations showing how $\calG$ can be homorphically transformed into $\calG'''$ by composition of \cref{le:21may19.2-CID-hom-from-node-copying-and-deleting,le:21may19.2-CID-hom-from-edge-pruning}.
    In the first step from $\calG$ to $\calG'$, $Y$ is removed; in the step from $\calG'$ to $\calG''$ a decision is duplicated; and in the final step from $\calG''$ to $\calG'''$, a link is removed.
    Since 
    the mapping at each step (blue, green, and orange respectively)
    meets the definition of an ID homomorphism, $\calG'''$ must be an ID homorphism of $\calG$ (\cref{le:20dec7.1-composition-of-CID-splits}).
    }
    \label{fig:homorphism}
\end{figure}

An ID homomorphism is analogous to the notion of graph homomorphism from graph theory, which essentially requires that edges are preserved along the map. 
An ID homomorphism additionally
requires that decisions in the two graphs have equivalent parents (c), and that split decisions are connected (d). This requirement maintains a direct correspondence between policies on the two graphs, so that, as we will see, ID homomorphisms preserve VoI.
Examples of ID homorphisms are given in \cref{fig:homorphism}.
~\looseness=-1

\ryan{Cite graph homomorphisms?}
\chris{we could add a citation to graph theory, Diestel, 2017. Though it's also just a ``well known concept" and has a wikipedia page.}
\ryan{This is where we should have remarks about the intuition of this definition. But I don't understand 
what is being said about adding edges from each node to itself.}

The following three lemmas establish properties that are preserved under
ID homorphisms. %
\begin{restatable}[Preserves Solubility]{lemma}{lecidhomsufficientrecall} \label{20nov25.1-CID-homomorphism-preserves-sufficient-recall-SR}
Let $\sG=(\sV,E)$ and $\sG'=(\sV',E')$ be ID graphs. If $\sG$ is soluble, and there exists a homomorphism $h\colon\sV'\to\sV$, then $\sG'$ is also soluble.
\end{restatable}


\ryan{Probably we should uniformise to either $\calG'/\calM'$ or $\bar \calG \bar \calM$ throughout this section}

Given a homomorphism $h$ from $\sG'$ to $\sG$, we can define a notion of 
equivalence between IDs (and policies) on each graph.
Roughly, two IDs are equivalent if the domain of every node 
is a cartesian product of the domains of the nodes in its pre-image (or the 
sum, in the case of a utility node).
Formally:

\begin{definition}[Equivalence]
$\calM_\pi$ on $\calG$ and $\calM'_{\pi'}$ on $\calG_{\pi'}$ are \emph{equivalent} if
each non-utility node $N$ in $\sG$ has $\dom(N):=\bigtimes_{N^i \in h^{-1}(N)} \dom(N^i)$,
and $P^\calM_\pi(N\!=\!(n^1,...,n^k))=P^{\calM'}_{\pi'}(N^1\!=\!n^1,...,N^k\!=\!n^k)$, 
and each utility node has $P^\calM_\pi(U\!=\!u)=P^{\calM'}_{\pi'}(\sum_{U^i\in h^{-1}(U)} U^i\! =\! u)$.
\end{definition}

\begin{restatable}[Equivalence]{lemma}{lecidhomequivalence} \label{le:cidhom1-equivalence}
If there is an ID homomorphism $h$ from $\sG '$ to $\sG$,
then for any policy $\pi'$ in any ID $\calM'$ on $\sG '$ 
there is a policy $\pi$ in a ID $\calM$ on $\sG$ 
such that $\calM_\pi$ and $\calM'_{\pi'}$ are equivalent. 
\tom{what does it mean for two probability distributions to be equivalent?}
\end{restatable}
\ryan{Changed from $\tilde M$ to $M'$ here. May need to make corresponding change to proof in appendix}

In this case, we will call $\calM$ and $\pi$ the \emph{ID and policy transported along the homomorphism $h$}. In the appendix, we show that this correspondence between policies on $\calM'$ and $\calM$ is a bijection.
\ryan{The one-sentence explanation above isn't very explanatory.}
\chris{I just removed it}
Intuitively, if there is an ID homomorphism $\sG'\to \sG$, this means we have a particular way to \textit{fit an ID on $\sG'$ into $\sG$}, while preserving the information that the decisions can access.
The basis of this proof is that properties (c,d) of ID homomorphisms (\cref{def:CID-homomorphism}) require decisions to have precisely the same information in $\cal M$ as in $\cal M'$.~\looseness=-1


\ryan{``interpreted as'' feels a bit too informal to me.}



For our proof of \cref{thm:voi}, we will require that VoI is preserved under homomorphism.

\input{theorems/CIDHOM-preserves-materiality}


The proof builds heavily on there being a precise correspondence between policies on $\cal M$ and on $\cal M'$. Since these two IDs are equivalent (\cref{le:cidhom1-equivalence}), if obtaining certain information in $\cal M'$ has value, so does obtaining that information in $\cal M$. The formal details are left to \cref{sec:CID-homomorphisms}.~\looseness=-1



We next present two transformation rules\chris{rudimentary calculus is kind of a weird phrasing} with which to modify any ID graph, which are illustrated in \cref{fig:homorphism}.
The first transformation obtains a new graph $\sG'$ by deleting or duplicating nodes, while preserving all links. Under this transformation, the function that maps a node in $\sG'$ to its `originating node' in $\sG$ is an ID homomorphism:
~\looseness=-1





\newcommand{\sCopies}{\mathrm{Copies}}
\begin{restatable}[Deletion \& Link-Preserving Copying]{lemma}{lecopyingcidhom} \label{le:21may19.2-CID-hom-from-node-copying-and-deleting}
Let $\sG\!\!=\!\!(\sV, E)$ be an ID graph and $\sG'\!=\!(\bigcup_{N\in\sV}\sCopies(N),E')$ an ID graph where $\sCopies$ maps nodes in $\sG$ to disjoint sets in $\sG'$, and where $E'$ is a minimal set of edges such that 
for any edge $A \to B$ in $E$ and $A^i\in \sCopies(A)$ and $B^i\in \sCopies(B)$ there is an edge $A^i\to B^i$,
and if  $A^i,A^j\in \sCopies(A)$ are non-utility nodes then 
either
$A^i\to A^j$ or $A^i\gets A^j$. Then the function $h$ that maps each $V\in \sCopies(N)$ to $N$ is an ID homomorphism.~\looseness=-1

\end{restatable}
\ryan{I've simplified/shortened this a bit further. Feel free to revert any changes is preferred.}

Edges that are not information links can also be removed, while having a homomorphism back to the original:



\begin{restatable}[Link Pruning]{lemma}{lepruningcidhom} \label{le:21may19.2-CID-hom-from-edge-pruning}
Let $\sG=(\sV,E)$ and $\sG'=(\sV,E')$ be ID graphs, where $E'\subseteq E$ and where for each decision node $D$ in $\sV$, every incoming edge $N\to D$ in $E$ is in $E'$. Then the identity function $h(N)=N$ on $\sV$ is a homomorphism from $\sG'$ to $\sG$.
\end{restatable}

Finally, we can chain together a sequence of such graph transformation steps, and still maintain a homomorphism to the original. The justification for this is that a composition of ID homomorphisms is again an ID homomorphism:~\looseness=-1

\begin{restatable}[Composition]{lemma}{lecidhomcomposition} \label{le:20dec7.1-composition-of-CID-splits}
If $h\colon\sG' \to \sG$ and $h'\colon\sG'' \to \sG'$ are ID homomorphisms then the composition $h \circ h'\colon\sG'' \to \sG$ is an ID homomorphism.
\end{restatable}