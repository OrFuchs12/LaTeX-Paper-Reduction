\section{Proofs}
\label{appendix:proof}

\subsection{Preliminary Lemmas}

\begin{lemma}
\label{lemma:7}
For any states $s, \bar{s} \in \cS$ and (deterministic) policies $\pi, \bar{\pi}$, we have
%
\begin{alignat*}{2}
    \norm{\phi(s, \pi(s)) - \phi(\bar{s}, \bar{\pi}(\bar{s}))}
    \le L_\phi \cdot d_\cS(s, \bar{s}) + L_\phi \cdot d_\cA(\pi(s), \bar{\pi}(\bar{s})).
\end{alignat*}
\end{lemma}

\smallskip
\begin{proof}
By Assumption~\ref{assumption:lipschitz_feature}, for any states $s, \bar{s} \in \cS$ and policies $\pi, \bar{\pi}$, we have
%
\begin{alignat*}{2}
    \norm{\phi(s, \pi(s)) - \phi(\bar{s}, \bar{\pi}(\bar{s}))}
    \le &\ L_\phi \cdot d_{\cS\cA}((s, \pi(s)), (\bar{s}, \bar{\pi}(\bar{s}))).
\end{alignat*}
%
By definition of $d_{\cS \cA}$, we have
%
\[
    d_{\cS\cA}((s, \pi(s)), (\bar{s}, \bar{\pi}(\bar{s}))) = d_\cS(s, \bar{s}) + d_\cA(\pi(s), \bar{\pi}(\bar{s})).
\]
%
In the above transformation, we used the assumption that policies $\pi, \bar{\pi}$ are deterministic.
%
In summary, the following inequality holds:
%
\begin{alignat*}{2}
    \norm{\phi(s, \pi(s)) - \phi(\bar{s}, \bar{\pi}(\bar{s}))}
    \le &\ L_\phi \cdot d_\cS(s, \bar{s}) + L_\phi \cdot d_\cA(\pi(s), \bar{\pi}(\bar{s})).
\end{alignat*}
\end{proof}

\begin{lemma}
    Suppose, at every time step $t$, the agent's policy $\pi$ satisfies $\norm{\pi(s_t) - \pi^\sharp(s_t)} \le x_t$.
    Then, for any policy $\pi$ and two succeeding states $s_t$ and $s_{t+1} \sim P(\cdot \mid s_t, \pi(s_t))$, we have
    \begin{align}
        \label{eq:diff_phi_t_tp1}
        \norm{\phi(s_{t+1}, \pi(s_{t+1})) - \phi(s_t, \pi(s_t))}
        \le &\ L_\phi \cdot (1 + L_\sharp) \cdot d_\cS(s_t, s_{t+1}) + L_\phi \cdot  (x_t + x_{t+1}).
    \end{align}
\end{lemma}

\smallskip
\begin{proof}
    By Lemma~\ref{lemma:7}, for any policy $\pi$ and two succeeding states $s_t$ and $s_{t+1} \sim P(\cdot \mid s_t, \pi(s_t))$, we have
    %
    \begin{align*}
        \norm{\phi(s_{t+1}, \pi(s_{t+1})) - \phi(s_t, \pi(s_t))}
        \le &\ L_\phi \cdot d_\cS(s_t, s_{t+1}) + L_\phi \cdot d_\cA(\pi(s_t), \pi(s_{t+1})).
    \end{align*}
    %
    By applying the triangle inequality to the second term, we have
    %
    \begin{align*}
        d_\cA(\pi(s_t), \pi(s_{t+1}))
        \le &\ d_\cA(\pi(s_t), \pi^\sharp(s_t)) + d_\cA(\pi^\sharp(s_t), \pi^\sharp(s_{t+1})) + d_\cA(\pi^\sharp(s_{t+1}), \pi(s_{t+1})) \\
        \le &\ x_t + L_\sharp \cdot d_\cS(s_t, s_{t+1}) + x_{t+1}.
    \end{align*}
    %
    In the above transformation, we used Assumption~\ref{assumption:stabilizing}.
    In summary, the following desired inequality can be obtained:
    %
    \begin{align*}
        \norm{\phi(s_{t+1}, \pi(s_{t+1})) - \phi(s_t, \pi(s_t))}
        \le &\ L_\phi \cdot d_\cS(s_t, s_{t+1}) + L_\phi \cdot \left( x_t + L_\sharp \cdot d_\cS(s_t, s_{t+1}) + x_{t+1} \right) \\
        = &\ L_\phi \cdot (1 + L_\sharp) \cdot d_\cS(s_t, s_{t+1}) + L_\phi \cdot  (x_t + x_{t+1}).
    \end{align*}
\end{proof}

\begin{lemma}
    \label{lemma:diff_phi}
    Set $\bar{L}_\sharp \coloneqq L_\sharp + 1$.
    Suppose that, for any time step $t \in [T]$ and state $s_t \in \cS$, a policy $\pi$ takes an action such that $d_\cA(\pi(s_t), \pi^\sharp(s_t)) \le x_t$.
    Then, we have
    %
    \begin{align*}
        &\ \norm{\phi(s_{t+1}, \pi(s_{t+1})) - \phi(s_t, \pi(s_t))} \\
        \le &\ L_\phi \cdot \{\bar{L}_\sharp \cdot \bar{d} + (1 + \eta \bar{L}_\sharp) \cdot x_t + x_{t+1}\}.
    \end{align*}
\end{lemma}

\begin{proof}
    By Assumption~\ref{assumption:stabilizing}, we have
    \begin{align*}
        d_\cS(s_t, s_{t+1}) \le \bar{d} + \eta \cdot x_t.
    \end{align*}
    %
    By applying the above inequality to \eqref{eq:diff_phi_t_tp1}, the following inequality holds:
    %
    \begin{align*}
        \norm{\phi(s_{t+1}, \pi(s_{t+1})) - \phi(s_t, \pi(s_t))}
        \le &\ L_\phi \cdot \{(1 + L_\sharp) \cdot \bar{d} + (1 + \eta + L_\sharp \eta) \cdot x_t + x_{t+1}\} \\
        = &\ L_\phi \cdot \{\bar{L}_\sharp \cdot \bar{d} + (1 + \eta \bar{L}_\sharp) \cdot x_t + x_{t+1}\}.
    \end{align*}
    %
    Then we have the desired lemma.
\end{proof}

\subsection{Proof of Lemma~\ref{lemma:f_t_T}}
\label{proof:A_2}
\begin{lemma}
    \label{lemma:9}
    Suppose that Assumptions~\ref{assumption:lipschitz_feature} and \ref{assumption:stabilizing} hold. Also assume that, at every time step $t$, the agent's policy $\pi$ satisfies $\norm{\pi(s_t) - \pi^\sharp(s_t)} \le x_t$. Then, we have
    \begin{align*}
        \norm{\phi(s_T, \pi(s_T)) - \phi(s_t, \pi(s_t))}
        \le &\ L_\phi \cdot \left\{\bar{L}_\sharp \cdot \bar{d} \cdot (T-t) + (1 + \eta \bar{L}_\sharp) \cdot x_t + (2 + \eta \bar{L}_\sharp) \cdot \sum_{\tau=t+1}^{T-1} x_\tau + x_{T} \right\}.
    \end{align*}
\end{lemma}

\begin{proof}
    By triangle inequality, we have
    %
    \begin{align}
        \norm{\phi(s_T, \pi(s_T)) - \phi(s_t, \pi(s_t))} \le \sum_{i=t}^{T-1} \norm{\phi(s_{i+1}, \pi(s_{i+1})) - \phi(s_i, \pi(s_i))}.
    \end{align}
    %
    By Lemma~\ref{lemma:diff_phi}, the following inequalities hold for all $i \in [t, T-1]$:
    %
    \begin{align}
        \norm{\phi(s_{i+1}, \pi(s_{i+1})) - \phi(s_i, \pi(s_i))}
        = &\ L_\phi \cdot \{\bar{L}_\sharp \cdot \bar{d} + (1 + \eta \bar{L}_\sharp) \cdot x_i + x_{i+1}\}
    \end{align}
    %
    By summing the above inequality up from $i = t, t+1, \ldots, T-1$,
    %
    \begin{align*}
        \norm{\phi(s_T, \pi(s_T)) - \phi(s_t, \pi(s_t))}
        \le &\ L_\phi \cdot \{\bar{L}_\sharp \cdot \bar{d} + (1 + \eta \bar{L}_\sharp) \cdot x_t + x_{t+1}\} \\
        &\ + L_\phi \cdot \{\bar{L}_\sharp \cdot \bar{d} + (1 + \eta \bar{L}_\sharp) \cdot x_{t+1} + x_{t+2}\} \\
        &\ + \cdots \\
        &\ + L_\phi \cdot \{\bar{L}_\sharp \cdot \bar{d} + (1 + \eta \bar{L}_\sharp) \cdot x_{T-1} + x_{T}\} \\
        = &\ L_\phi \cdot \left\{\bar{L}_\sharp \cdot \bar{d} \cdot (T-t) + (1 + \eta \bar{L}_\sharp) \cdot x_t + (2 + \eta \bar{L}_\sharp) \cdot \sum_{\tau=t+1}^{T-1} x_\tau + x_{T} \right\}.
    \end{align*}
    %
    Then we obtained the desired lemma.
\end{proof}

\smallskip
\begin{proof}(of Lemma~\ref{lemma:f_t_T})
    By Assumption~\ref{assumption:linear} and Cauchyâ€“Schwarz inequality, 
    %
    \begin{align*}
        \abs{f^\star(s_T, \pi(s_T)) - f^\star(s_t, \pi(s_t))} &\le \norm{\bm{w}^\star} \cdot \norm{\phi(s_T, \pi(s_T)) - \phi(s_t, \pi(s_t))} \\
        & \le \sqrt{m} \cdot \norm{\phi(s_T, \pi(s_T)) - \phi(s_t, \pi(s_t))}.
    \end{align*}
    %
    By combining the above inequality and Lemma~\ref{lemma:9}, we have
    %
    \begin{equation*}
        \abs{f^\star(s_T, \pi(s_T)) - f^\star(s_t, \pi(s_t))} \le \sqrt{m} \cdot L_\phi \cdot \left\{\bar{L}_\sharp \cdot \bar{d} \cdot (T-t) + (1 + \eta \bar{L}_\sharp) \cdot x_t + (2 + \eta \bar{L}_\sharp) \cdot \sum_{\tau=t+1}^{T-1} x_\tau + x_{T} \right\}.
    \end{equation*}
    %
    Recall the definitions of $L_1$, $L_2$, and $L_3$; that is, $L_1 \coloneqq \sqrt{m} \cdot L_\phi$, $L_2 \coloneqq \bar{L}_\sharp \cdot \bar{d}$, and $L_3 \coloneqq 2 + \eta \bar{L}_\sharp$. Then, the following inequalities holds:
    %
    \begin{equation*}
        \abs{f^\star(s_T, \pi(s_T)) - f^\star(s_t, \pi(s_t))} \le L_1 \cdot \left\{L_2 \cdot (T-t) + (L_3 - 1) \cdot x_t + L_3 \cdot \sum_{\tau=t+1}^{T-1} x_\tau + x_{T} \right\}.
    \end{equation*}
    %
    By definitions of $\bar{t} \coloneqq T - t$ and $X_{t+1}^{T-1} \coloneqq \sum_{\tau=t+1}^{T-1} x_\tau$, we have
    %
    \begin{equation*}
        \abs{f^\star(s_T, \pi(s_T)) - f^\star(s_t, \pi(s_t))} \le L_1 \cdot \left\{L_2 \cdot \bar{t} + (L_3 - 1) \cdot x_t + L_3 \cdot X_{t+1}^{T-1} + x_{T} \right\}.
    \end{equation*}
    %
\end{proof}

\subsection{Proof of Lemma~\ref{lemma:f_1_t}}
\label{proof:A_3}
\begin{lemma}
    Suppose that Assumptions~\ref{assumption:lipschitz_feature} and \ref{assumption:stabilizing} hold. Also assume that, at every time step $t$, the agent's policy $\pi$ satisfies $\norm{\pi(s_t) - \pi^\sharp(s_t)} \le x_t$. Then, we have
    \begin{align*}
        \norm{\phi(s_t, \pi(s_t)) - \phi(s_1, \pi(s_1))}
        \le &\ L_\phi \cdot \left\{\bar{L}_\sharp \cdot \bar{d} \cdot t + (1 + \eta \bar{L}_\sharp) \cdot x_1 + (2 + \eta \bar{L}_\sharp) \cdot \sum_{\tau=2}^{t-1} x_\tau + x_{t} \right\}.
    \end{align*}
\end{lemma}

\smallskip
\begin{proof}
    Similarly to the proof of Lemma~\ref{lemma:f_t_T}, we sum up the inequality \eqref{eq:diff_phi_t_tp1} for $i = 1, 2, \ldots, t-1$ and then obtain
    %
    \begin{align*}
        \norm{\phi(s_t, \pi(s_t)) - \phi(s_1, \pi(s_1))}
        \le &\ L_\phi \cdot \{\bar{L}_\sharp \cdot \bar{d} + (1 + \eta \bar{L}_\sharp) \cdot x_1 + x_{2}\} \\
        &\ + L_\phi \cdot \{\bar{L}_\sharp \cdot \bar{d} + (1 + \eta \bar{L}_\sharp) \cdot x_{2} + x_{3}\} \\
        &\ + \cdots \\
        &\ + L_\phi \cdot \{\bar{L}_\sharp \cdot \bar{d} + (1 + \eta \bar{L}_\sharp) \cdot x_{t-1} + x_{t}\} \\
        = &\ L_\phi \cdot \left\{\bar{L}_\sharp \cdot \bar{d} \cdot t + (1 + \eta \bar{L}_\sharp) \cdot x_1 + (2 + \eta \bar{L}_\sharp) \cdot \sum_{\tau=2}^{t-1} x_\tau + x_t \right\}.
    \end{align*}
    %
    Then we obtained the desired lemma.
\end{proof}

\begin{lemma}
    \label{lemma:11}
    Suppose the policy $\pi$ takes the same action to the conservative policy $\pi^\sharp$ at the initial time step; that is, we set $\pi(s_1) = \pi^\sharp(s_1)$ and then $x_1 = 0$.
    We then have
    \begin{align*}
        \norm{\phi(s_t, \pi_t(s_t)) - \phi(s_1, \pi^\sharp(s_1))}
        \le &\ L_\phi \cdot \left\{\bar{L}_\sharp \cdot \bar{d} \cdot t + (2 + \eta \bar{L}_\sharp) \cdot \sum_{\tau=2}^{t-1} x_\tau + x_{t} \right\}.
    \end{align*}
\end{lemma}

\smallskip
\begin{proof}(of Lemma~\ref{lemma:f_1_t})
    By Assumption~\ref{assumption:linear},
    %
    \begin{align*}
        \abs{f^\star(s_t, \pi(s_t)) - f^\star(s_1, \pi^\sharp(s_1))}
        & \le \norm{\bm{w}^\star} \cdot \norm{\phi(s_t, \pi_t(s_t)) - \phi(s_1, \pi^\sharp(s_1))} \\
        & \le \sqrt{m} \cdot \norm{\phi(s_t, \pi_t(s_t)) - \phi(s_1, \pi^\sharp(s_1))}.
    \end{align*}
    %
    By combining Lemma~\ref{lemma:11} and the aforementioned inequality, we have
    %
    \begin{align*}
        \abs{f^\star(s_t, \pi(s_t)) - f^\star(s_1, \pi^\sharp(s_1))}
        & \le \norm{\bm{w}^\star} \cdot L_\phi \cdot \left\{\bar{L}_\sharp \cdot \bar{d} \cdot t + (2 + \eta \bar{L}_\sharp) \cdot \sum_{\tau=2}^{t-1} x_\tau + x_{t} \right\}.
    \end{align*}
    %
    Define $f^\sharp(s) \coloneqq f^\star(s, \pi^\sharp(s))$ for all $s \in \cS$.
    Based on the definitions of $L_1 \coloneqq \sqrt{m} \cdot L_\phi$, $L_2 \coloneqq \bar{L}_\sharp \cdot \bar{d}$, and $L_3 \coloneqq 2 + \eta \bar{L}_\sharp$, we have
    \begin{align*}
        \abs{f^\star(s_t, \pi(s_t)) - f^\sharp(s_1)}
        \le L_1 \left\{L_2 \, t + L_3 X_{2}^{t-1} + x_{t} \right\}.
    \end{align*}
\end{proof}

\subsection{Proof of Lemma~\ref{lemma:lower_bound}}
\label{appendix:A_5}

\begin{proof}(of Lemma~\ref{lemma:lower_bound})
    By Lemma~\ref{lemma:confidence_bound}, the following inequality holds regarding the lower-bound based on GLM:
    %
    \begin{equation}
        f^\star(s_t, a_t) \ge \ell_{\text{GLM}}(s_t, a_t)
    \end{equation}
    %
    with a probability of at least $1 - \Delta$.
    %
    Also, by Lemma~\ref{lemma:f_1_t}, the following inequality holds (with a probability of $1$) regarding the lower-bound based on the Lipschitz continuity:
    %
    \begin{equation}
        f^\star(s_t, a_t) \ge \ell_{\text{Lipschitz}}(s_t, a_t).
    \end{equation}
    %
    By definition, $\ell(s_t, a_t) \coloneqq \max(\ell_\text{GLM}(s_t, a_t), \ell_\text{Lipschitz}(s_t, a_t))$; then, we have
    %
    \begin{equation}
        f^\star(s_t, a_t) \ge \ell(s_t, a_t)
    \end{equation}
    %
    with a probability of at least $1 - \Delta$.
\end{proof}

\subsection{Proofs of Lemma~\ref{lemma:f_ell_T} and Corollary~\ref{corollary:safety}}

\begin{proof}(of Lemma~\ref{lemma:f_ell_T})
    By Lemma~\ref{lemma:f_t_T},
    %
    \begin{align*}
        f^\star(s_T, \pi(s_T))
        \ge f^\star(s_t, \pi(s_t)) - L_1 \left\{L_2 \bar{t} + (L_3-1) x_t + L_3 X_{t+1}^{T-1} + x_{T} \right\}.
    \end{align*}
    %
    Also, by Lemma~\ref{lemma:lower_bound}, at time step $t$, we have
    %
    \begin{equation*}
        f^\star(s_t, a_t) \ge \ell(s_t, a_t)
    \end{equation*}
    %
    By combining the above two inequalities, we have
    %
    \begin{align*}
        f^\star(s_T, \pi(s_T))
        \ge \ell(s_t, a_t) - L_1 \left\{L_2 \bar{t} + (L_3-1) x_t + L_3 X_{t+1}^{T-1} + x_{T} \right\}.
    \end{align*}
    %
\end{proof}

\begin{proof}(of Corollary~\ref{corollary:safety})
    For a scalar $z \in \mathbb{R}$, suppose that the following inequality holds:
    %
    \[
        \ell(s_t, a_t) - L_1 \left\{L_2 \bar{t} + (L_3-1) x_t + L_3 X_{t+1}^{T-1} + x_{T} \right\} \ge z
    \]
    %
    Then, by Lemma~\ref{lemma:f_ell_T}, the following inequality also immediately holds:
    %
    \[
        f^\star(s_T, \pi(s_T)) \ge z.
    \]  
    %
    In addition, by definitions, we have $L_1 \ge 0$, $L_2 \ge 0$, $L_3 \ge 1$, and $x_\tau \ge 0, \forall \tau \in [T]$.
    Thus, by Lemma~\ref{lemma:lower_bound}, we have
    %
    \[
        f^\star(s_t, \pi(s_t)) \ge \ell(s_t, \pi(s_t)) \ge z.
    \]
    %
    The aforementioned inequalities hold for all $\tau \in [t, T]$; thus, we have
    %
    \[
        f^\star(s_\tau, \pi(s_\tau)) \ge z, \quad \forall \tau \in [t, T].
    \]
\end{proof}

\subsection{Proof of Theorem \ref{theorem:safety}}

\begin{proof}(of Theorem \ref{theorem:safety})
Let $Y_t$ be the event that the following inequality is satisfied:
%
\begin{equation}
    \label{eq:Y}
    f^\star(s_t, a_t) \ge z.
\end{equation}
%
Also, Let $Z_t$ be the event that the following inequality holds:
%
\begin{equation}
    \label{eq:theorem_condition}
    \ell(s_t, a_t) - L_1 \left\{L_2 \bar{t} - x_t + L_3 X_{t}^{T-1} + x_{T} \right\} \ge z.
\end{equation}
%
When \eqref{eq:theorem_condition} holds, we have
%
\begin{equation*}
    f^\star(s_\tau, a_\tau) \ge z, \quad \forall \tau \in [t, T],
\end{equation*}
%
under Assumptions~\ref{assumption:lipschitz_feature} and \ref{assumption:stabilizing} as well as Corollary~\ref{corollary:safety}; hence, the above inequality means the satisfaction of 
%
\begin{equation}
    \Pr\bigl\{\, Y_t, Y_{t+1}, \ldots, Y_T \mid Z_t \,\bigr\} = 1.
\end{equation}
%
By Lemma~\ref{lemma:lower_bound}, the lower-bound $\ell$ is probabilistic; that is, $\Pr\bigl\{Z_t\bigr\} \ge 1 - \Delta$; hence,
%
\begin{align*}
    \Pr\Bigl\{\, Y_t, Y_{t+1}, \ldots, Y_T \,\Bigr\} = 1 - \Delta,
\end{align*}
%
which means that
%
\begin{align*}
    \Pr\Bigl\{\, f^\star(s_\tau, a_\tau) \ge z \quad \forall \tau \in [t, T] \,\Bigr\} = 1 - \Delta.
\end{align*}
%
Finally, the binary safety feedback is stochastic per the GLM; that is, at every time step $\tau \in [t, T]$, safety feedback of $1$ can be obtained with a probability at least $1 - \mu(z)$.
In summary, we have 
%
\[
    \Pr \Bigl\{ g(s_\tau, a_\tau) = 1 \ \ \forall \tau \in [t, T] \Big\} \ge (1 - \mu(z))^{\bar{t}}.
\]
\end{proof}
