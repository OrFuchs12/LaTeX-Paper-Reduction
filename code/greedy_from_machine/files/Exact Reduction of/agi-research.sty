\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{agi-research}

\RequirePackage{mathrsfs}
\RequirePackage{stmaryrd}
\RequirePackage{bbm}
\RequirePackage{mathtools}

%TODO: FIX BREQN SUPPORT
% Required : dmath -> beq
% Required : dgroup -> bqa
% auto-break equations
\RequirePackage{flexisym}
\RequirePackage{breqn}

%--------------------------------------------------------
% equations renaming (experimental)
%--------------------------------------------------------

% Be careful when defining macros: \span is used for this environment.
% do not redefine standard macros, e.g. \span

\RequirePackage[overload]{empheq}
\def\bsubeq#1#2\esubeq{
\begin{subequations}
    \begin{empheq}[left={#1 \empheqlbrace}]{alignat=2}
        #2
    \end{empheq}
\end{subequations}
}

\def\xbqs#1\xeqs{\begin{dgroup*}\begin{dmath}#1\end{dmath}\end{dgroup*}}
\def\xbqsn#1\xeqsn{\begin{dgroup*}\begin{dmath*}#1\end{dmath*}\end{dgroup*}}

\def\xbeq#1\xeeq{\begin{dmath}#1\end{dmath}}
\def\xbeqn#1\xeeqn{\begin{dmath*}#1\end{dmath*}}


\DeclareFlexCompoundSymbol{\coloneqq}{Rel}{\mathrel{{\rlap{\raisebox{0.3ex}{$\m@th\cdot$}}\raisebox{-0.3ex}{$\m@th\cdot$}}=}}

\DeclareFlexCompoundSymbol{\eqqcolon}{Rel}{={\rlap{\raisebox{0.3ex}{$\m@th\cdot$}}\raisebox{-0.3ex}{$\m@th\cdot$}}}


%--------------------------------------------------------
% equations renaming
%--------------------------------------------------------

% Be careful when defining macros: \span is used for this environment.
% do not redefine standard macros, e.g. \span

\def\beq#1\eeq{\begin{equation}#1\end{equation}}
\def\beqn#1\eeqn{\begin{equation*}#1\end{equation*}}

\def\bqa#1\eqa{\begin{align}#1\end{align}}
\def\bqan#1\eqan{\begin{align*}#1\end{align*}}

\def\bqs#1\eqs{\begin{subequations}\begin{align}#1\end{align}\end{subequations}}
\def\bqsn#1\eqsn{\begin{subequations}\begin{align*}#1\end{align*}\end{subequations}}

\newcommand\numberthis{\addtocounter{equation}{1}\tag{\theequation}}


%--------------------------------------------------------
% sets
%--------------------------------------------------------

\newcommand{\SetN}{\mathbb{N}}           % set of naturals
\newcommand{\SetZ}{\mathbb{Z}}           % set of integers
\newcommand{\SetQ}{\mathbb{Q}}           % set of rationals
\newcommand{\SetR}{\mathbb{R}}           % set of reals
\newcommand{\SetC}{\mathbb{C}}           % set of complexes :)

\newcommand{\PowSet}{\mathcal{P}}        % power set
\newcommand{\Dist}{\triangle}            % probability distribution over a set

\newcommand{\SetNP}{\mathbb{N}^{+}}           % set of naturals starting from one
\newcommand{\SetZP}{\mathbb{Z}^{+}}           % set of positive integers
\newcommand{\SetQP}{\mathbb{Q}^{+}}           % set of positive rationals
\newcommand{\SetRP}{\mathbb{R}^{+}}           % set of positive reals

\newcommand{\SetB}{\mathbb{B}}           % set of binaries
\newcommand{\SetP}{\mathbb{P}}           % set of primes

% originally \H is an accent
\renewcommand{\H}{\mathscr{H}}         % set of histories

% originally \S is copyright symbol
\renewcommand{\S}{\mathscr{S}}         % set of states

% originally \O is an additinal Latin letter
\renewcommand{\O}{\mathscr{O}}         % set of observations

\newcommand{\A}{\mathscr{A}}         % set of actions
\newcommand{\R}{\mathscr{R}}         % set of rewards
\newcommand{\OR}{\mathscr{E}}        % set of percepts
\newcommand{\B}{\mathscr{B}}         % set of options/plans
\newcommand{\Z}{\mathscr{Z}}         % set of parameters
\newcommand{\X}{\mathscr{X}}         % set of environment states

\newcommand{\HA}{\H_\A}              % joint history-action space

\newcommand{\F}{\mathcal{F}}         % filteration
\newcommand{\G}{\mathcal{G}}         % another filteration

\newcommand{\M}{\mathcal{M}}                % set of models
\newcommand{\U}{\mathcal{U}}                % the universe of models/TM

%--------------------------------------------------------
% operations
%--------------------------------------------------------

\newcommand{\norm}[2][]{{\left\lVert#2\right\rVert_{#1}}}     % norm
\newcommand{\abs}[1]{{\left\lvert#1\right\rvert}}             % absolute
\newcommand{\ones}[1]{{\rm ones}\left(#1\right)}              % number of 1s
\newcommand{\zeros}[1]{{\rm zeros}\left(#1\right)}            % number of 0s
\newcommand{\cnt}[1]{\# \left(#1\right)}                      % count
\newcommand{\trp}{^\top}                                      % transpose
\newcommand{\inv}{^{-1}}                                      % inverse

\DeclareMathOperator*{\argmax}{arg\,max}                      % arg max
\DeclareMathOperator*{\argmin}{arg\,min}                      % arg min
\DeclareMathOperator*{\argsup}{arg\,sup}                      % arg sup
\DeclareMathOperator*{\arginf}{arg\,inf}                      % arg inf

\DeclarePairedDelimiter\ceil{\lceil}{\rceil}                  % ceiling
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}               % floor

\newcommand{\avg}[2][]{\left\langle #2 \right\rangle_{#1}}    % average/expectation
\newcommand{\limit}[2][\infty]{\lim_{#2\to#1}}                % limit
\newcommand{\limitinf}[2][\infty]{\liminf_{#2\to#1}}          % limit inf
\newcommand{\limitsup}[2][\infty]{\limsup_{#2\to#1}}          % limit sup
%TODO: this is a design choice to hide all relationships in \ind commmand
\newcommand{\ind}[1]{{\mathbbm 1}(\hiderel{#1})}                        % indicator function
\newcommand{\hold}[1]{\left\llbracket #1 \right\rrbracket}    % inverson brackets
\newcommand{\fracp}[2]{\left(\frac{#1}{#2}\right)}            % fraction with parentheses
\newcommand{\spn}{{\rm span}}                                 % span

%--------------------------------------------------------
% variations
%--------------------------------------------------------

% originally they are all accents
\renewcommand{\v}[1]{\boldsymbol{#1}}             % vector or matrix notation
\renewcommand{\t}[1]{\widetilde{#1}}
\renewcommand{\d}[1]{\dot{#1}}
\renewcommand{\u}[1]{\breve{#1}}
\renewcommand{\b}[1]{\bar{#1}}

\newcommand{\vo}[1]{\v{\overline{#1}}}
\newcommand{\dd}[1]{\ddot{#1}}
\newcommand{\h}[1]{\widehat{#1}}


%--------------------------------------------------------
% constants & symbols
%--------------------------------------------------------

\newcommand{\e}{{\rm e}}                     % natural base e
\newcommand{\eps}{\varepsilon}               % a small real numbe
\newcommand{\E}{{\rm E}}                     % Expectation
\newcommand{\Var}{{\rm Var}}		         % Variance
\newcommand{\lb}{{\log_2}}                   % binary log

\newcommand{\del}{\delta}
\newcommand{\Del}{\Delta}
\newcommand{\g}{\gamma}
\newcommand{\w}{\omega}

\newcommand{\true}{\textsf{true}}
\newcommand{\false}{\textsf{false}}
\newcommand{\ndefined}{\textsf{undefined}}
%\newcommand{\contradiction}{\Rightarrow\!\Leftarrow}
\newcommand{\contradiction}{\lightning}

\newcommand{\KL}{{\rm KL}}		            % KL divergence
\newcommand{\wpone}{{\rm w.p.1}}		    % with probability 1
\newcommand{\as}{{\rm a.s.}}		        % almost surely

%--------------------------------------------------------
% macros
%--------------------------------------------------------

\newcommand{\paradot}[1]{\noindent{\bf\boldmath{#1.}}} % paragraph with heading with a dot at the end.

\def\QBAvg#1#2#3#4{{\langle Q^{#1}({#2}^{-1}(#3),#4)\rangle_B}}
\def\QBAvg#1#2#3#4#5{{\langle Q^{#1}({#2}^{-1}(#3),#4)\rangle_{B^{#5}}}}
\def\QBarBAvg#1#2#3#4{{\langle \bar{Q}^{#1}({#2}^{-1}(#3),#4)\rangle_B}}
\def\VBAvg#1#2#3{{\langle V^{#1}({#2}^{-1}(#3))\rangle_B}}
\def\VBAvg#1#2#3#4{{\langle V^{#1}({#2}^{-1}(#3))\rangle_{B^{#4}}}}
\def\VBarBAvg#1#2#3{{\langle \bar{V}^{#1}({#2}^{-1}(#3))\rangle_B}}

\def\QWAvg#1#2#3#4{{\langle Q^{#1}({#2}^{-1}(#3),#4)\rangle_w}}
\def\QWAvg#1#2#3#4#5{{\langle Q^{#1}({#2}^{-1}(#3),#4)\rangle_{w^{#5}}}}
\def\QBarWAvg#1#2#3#4{{\langle \bar{Q}^{#1}({#2}^{-1}(#3),#4)\rangle_w}}
\def\VWAvg#1#2#3{{\langle V^{#1}({#2}^{-1}(#3))\rangle_w}}
\def\VBarWAvg#1#2#3{{\langle \bar{V}^{#1}({#2}^{-1}(#3))\rangle_w}}


\def\BV{\bar{V}}
\def\BQ{\bar{Q}}